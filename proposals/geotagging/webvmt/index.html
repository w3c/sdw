<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <title>WebVMT: The Web Video Map Tracks Format</title>
    <script
     src='https://www.w3.org/Tools/respec/respec-w3c'
     class='remove'></script>
    <script class='remove'>
      var respecConfig = {
        specStatus: "ED",
        editors: [{
          name: "Rob Smith",
          mailto: "rob.smith@awayteam.co.uk",
          company: "Away Team Software Ltd",
          companyURL: "http://www.awayteam.co.uk",
          w3cid: 105524
        }],
        charterDisclosureURI: "https://www.w3.org/2017/sdwig/charter.html#patentpolicy",
        edDraftURI: "https://w3c.github.io/sdw/proposals/geotagging/webvmt/",
        shortName: "webvmt",
        group: "wg/sdw",
        wgPublicList: "public-sdwig",
        github: "https://github.com/w3c/sdw"
      };
    </script>
    <style>
      .css.css {
        color: #005a9c;
        font-size: inherit;
        font-family: inherit;
      }
      .css::before {
        content: "‘";
      }
      .css::after {
        content: "’";
      }
      .css-selector-table {
        border-collapse: collapse;
      }
      .css-selector-table tr {
        vertical-align: top;
      }
      .css-selector-table td {
        border-top:1px solid silver;
      }
      .css-selector-table th, td {
        padding: 0.5em 1em;
      }
      .css-selector-table pre {
        background-color: inherit;
      }
    </style>
  </head>
  <body>
    <section id='abstract'>
      <p>
        This specification defines WebVMT, the Web Video Map Tracks format, which is an enabling technology whose main use is for marking up external map track resources in connection with the HTML &lt;track&gt; element. WebVMT files provide map presentation and annotation synchronized to video content, including interpolation, and more generally any form of geolocation data that is time-aligned with audio or video content.
      </p>
    </section>
    <section id='sotd'>
      <p>
        This document is an explanatory specification, intended to communicate and develop the draft WebVMT format through discussion with user communities.
      </p>
    </section>
    <section class='informative' id='usecases'>
      <h2>Use Cases</h2>
      <p>
        Example scenarios in which WebVMT can add significant value, with a list of identified benefits.
      </p>
      <section id='mountainrescue'>
        <h2>Coastguard/Mountain Rescue</h2>
        <p>
          A missing person is reported to the rescue services, who deploy a drone to search inaccessible areas of coastline or moorland for their target. The drone relays back a live video stream from its camera and geolocation data from its GPS receiver to a remote human operator who is piloting it.
        </p>
        <p>
          As the search continues, the operator spots a target on the video feed and can instantly call up an electronic map, synchronized to the video, which has been automatically following the drone’s position and plotting its ground track. The display gives the operator immediate context for the video, and allows them to override the automatic map control and zoom in to pinpoint the target’s precise location from the features visible in the video and on the map/satellite view. They mark the location and then zoom out to assess the surrounding terrain and advise the recovery team of the best approach to the target. For example, the terrain may dictate very different approach routes if either the person has twisted their ankle at the top of a cliff, or has fallen and is lying at the bottom of the same cliff, though the co-ordinates are almost identical in both cases.
        </p>
        <p>
          The operator has been able to make important decisions quickly, which may be life critical, and deploy recovery resources effectively.
        </p>
        <ul class='note' title='Benefits'>
          <li>Rapid decision making;</li>
          <li>Effective resource deployment.</li>
        </ul>
      </section>
      <section id='areasurvey'>
        <h2>Area Survey</h2>
        <p>
          A survey drone is equipped with a camera which records an image of the ground directly below it. The pilot is a remote human operator, tasked with surveying a defined area from particular height in order to capture the required data.
        </p>
        <p>
          As the survey progresses, geometric shapes are automatically added to the map to represent areas which have been included. Once the drone has finished its sweep, the operator can quickly confirm whether the required area has been completely covered. If any areas have been missed, the pilot can use the map to navigate and make additional passes to fill the gaps, before returning to base.
        </p>
        <p>
          Adding map track (VMT) files to the survey archive provides a geospatial index to the videos, allowing a particular geographic location to be found more rapidly by virtue of their small file size. Online video archives can be indexed more quickly using this web-friendly format.
        </p>
        <p>
          The operator has been easily able to verify the quality of their own work and correct any errors, saving time and additional effort in redeployment. Video footage has been indexed by geolocation rapidly and in a search-engine-friendly format.
        </p>
        <ul class='note' title='Benefits'>
          <li>Autonomous quality assurance;</li>
          <li>Cost saving;</li>
          <li>Rapid archive indexing for search engines.</li>
        </ul>
      </section>
      <section id='outdoortrails'>
        <h2>Outdoor Trails</h2>
        <p>
          An outdoor sportsperson, e.g. snowboarder or cyclist, is equipped with a helmet camera and/or mobile phone to record video footage and GPS data. They set off to find new challenges and practice their skills, e.g. off-piste or on mountain trails, and discover new routes and areas that they would like to explore in future, chatting to the camera as they go. Afterwards, they upload the video to share their experience with the online community, so others can quickly identify locations of particularly interesting sections of the featured trail. Using the synchronized map view in their browser, community members can easily see where they need to go in order to try it for themselves.
        </p>
        <p>
          The operator has been able to fully engage in their sporting activity, without making any written notes, while simultaneously recording the details needed to guide others to the same locations. Their changing location over time can also be used to calculate speed and distance information, which can be displayed alongside the footage.
        </p>
        <ul class='note' title='Benefits'>
          <li>Non-invasive capture;</li>
          <li>Information sharing;</li>
          <li>Speed and distance calculation.</li>
        </ul>
      </section>
      <section id='tvsportscoverage'>
        <h2>TV Sports Coverage</h2>
        <p>
          A TV production company is covering a sports event that takes place over a large area, e.g. rallying, road cycling or sailing, using a number of mobile video devices including competitor cams, e.g. dash cams or helmet cams, and drones to provide shots of inaccessible areas, e.g. remote terrain or over water.
        </p>
        <p>
          Feeds from all the cameras are streamed to the production control room, where their geolocation data are combined on a map showing the locations of every competitor and camera, each labelled for easy identification. The live map enables the director to quickly choose the best shot and anticipate where and when to deploy their drone cameras to catch competitors at critical locations on the course as the competition develops in real time.
        </p>
        <p>
          Multiple operators can function concurrently, both autonomously and under central direction. Mobile assets can be monitored and deployed from an operations centre to provide optimum coverage of the developing live event.
        </p>
        <ul class='note' title='Benefits'>
          <li>Multiple mobile video devices;</li>
          <li>Real time asset management.</li>
        </ul>
      </section>
      <section id='proxyexplorer'>
        <h2>Proxy Explorer</h2>
        <p>
          Important details of a remote area have been captured on video. It is not possible to revisit the location for safety reasons or because it has physically changed in the intervening time. Footage can be retrospectively geotagged against a concurrent map to allow the viewer to better interpret and identify features seen in the footage. Explanatory annotations can be added to the video-map track to help future viewers' understanding and aggregate the collective analysis.
        </p>
        <p>
          Multiple operators can contribute their observations to provide a group analysis, iteratively adding new details and discarding out-of-date information. Experts can offer insight about filmed locations, which would otherwise be inaccessible to them.
        </p>
        <ul class='note' title='Benefits'>
          <li>Remote analysis of inaccessible locations;</li>
          <li>Knowledge aggregation and sharing for archive footage.</li>
        </ul>
      </section>
      <section id='treasurehunt'>
        <h2>Treasure Hunt</h2>
        <p>
          A TV production company designs a new game show which involves competitors searching for targets across a wide area, with an operations centre remotely monitoring their progress and providing updates. Competitors are equipped with body-worn video or helmet cameras to relay footage of their view.
        </p>
        <p>
          Geolocation context allow central operators to better understand the participants' actions and to remotely direct them more efficiently. Competitors' positions can displayed to the TV audience on annotated 2D- or 3D-maps for clearer presentation.
        </p>
        <ul class='note' title='Benefits'>
          <li>Speed and distance calculation;</li>
          <li>Knowledge aggregation and sharing for real-time footage.</li>
        </ul>
      </section>
      <section id='swarmmonitoring'>
        <h2>Swarm Monitoring</h2>
        <p>
          A swarm of drones is deployed to perform a task, and their operations are monitored centrally. Geolocation details of the swarm are automatically collated and broadcast to the drone pilots, showing the locations of all the drones and each is circled with a suitable safety zone to warn their operators in case two units find themselves flying in close proximity.
        </p>
        <p>
          Pilots are safely able to operate either autonomously or under the direction of central control. Extra zonal information can be added to the operators' maps to show the outer perimeter of their operating area and warn of fixed aerial hazards, e.g. a radio mast, or transient hazards, e.g. a helicopter.
        </p>
        <ul class='note' title='Benefits'>
          <li>Static and dynamic hazard indication;</li>
          <li>Central swarm monitoring;</li>
          <li>Autonomous swarm monitoring.</li>
        </ul>
      </section>
      <section id='crisisresponse'>
        <h2>Crisis Response</h2>
        <p>
          Disaster strikes, e.g. hurricane, tsunami, and emergency response teams are deployed to the affected area. However, it is difficult to verify which problems people are facing, what resources would help them and exactly where these events are occurring. Maps are unreliable as the infrastructure has been damaged, though people on the ground have the relevant knowledge if it could be reliably recorded and shared.
        </p>
        <p>
          Anyone with a basic smartphone could video events with reliable geospatial data, as GPS receivers can operate without the need for a mobile phone signal by using satellite data, to accurately document the problems they face. Even if the cell network is not operational, this information can be physically delivered to crisis coordinators to notify them of the issues that need to be addressed, including an accurate location in a common format. Crisis events can be reliably recorded, knowledge can be shared and aggregated, and relief resources can be accurately targeted and deployed to the correct locations.
        </p>
        <ul class='note' title='Benefits'>
          <li>Reliable dispersed information gathering and sharing;</li>
          <li>Accurate resource deployment.</li>
        </ul>
      </section>
      <section id='fastestlap'>
        <h2>Fastest Lap</h2>
        <p>
          An amateur racer attempts to set a fastest lap time in a vehicle equipped with a dashcam. The film can be reviewed with details of location and vehicle telemetry to analyse its performance, and that of the driver, to identify where improvements can be made. The ideal racing line can be determined and measured against the actual line taken, and optimum braking points can be established by suggesting and testing corrections.
        </p>
        <p>
          Driver's commentary can be used to identify performance issues along with vehicle audio response, e.g. engine tone and tyres, for comparison with telemetry data to rapidly iterate testing using community analysis tools. Results can be shared online in a common format to display metrics and to demonstrate veracity.
        </p>
        <ul class='note' title='Benefits'>
          <li>Data synchronisation with video and audio;</li>
          <li>Motion analysis using community tools.</li>
        </ul>
      </section>
      <section id='policeevidence'>
        <h2>Police Evidence</h2>
        <p>
          A web-based police system is established to allow dashcam video evidence of driving offences to be submitted digitally by members of the public who have witnessed them. Detectives are able to identify the time and vehicles involved directly from the uploaded footage, and accurately determine the location at which the incident occurred from the digital metadata included.
        </p>
        <p>
          Its ability to accept open format data also makes the system available to cyclists and pedestrians who can record video with location on their helmet cameras and smartphones respectively, providing wider access to the service beyond the dashcam community. Metadata, e.g. location, from different video manufacturers is often recorded in mutually-incompatible formats, but video-map track support enables synchronized location (and other) data to be extracted from recordings using manufacturers' or community tools, without affecting source video integrity, and submitted to the police system in a common format, significantly reducing development costs.
        </p>
        <p>
          Officers have been able to identify incident locations quickly and accurately, without sacrificing evidence integrity. The online service has been made available to a wider audience of drivers, cyclists and pedestrians, without incurring additional development costs.
        </p>
        <ul class='note' title='Benefits'>
          <li>Accurate location with evidence integrity preserved;</li>
          <li>Development costs reduced;</li>
          <li>Service extended to a wider audience.</li>
        </ul>
      </section>
      <section id='areamonitoring'>
        <h2>Area Monitoring</h2>
        <p>
          An area of interest is monitored operationally by a collection of different mobile video devices, e.g. drones, body-worn video, helicopter, etc. Video footage, possibly in different formats, is added to an archive with location (and other) metadata in a common format which forms a time-location index suitable for rapid parsing by a web crawler. Users can submit online queries to search by location and return a time-ordered sequence of video frame stills captured within a radial distance of the chosen location.
        </p>
        <p>
          Video archives can be quickly indexed using a common metadata format regardless of video encoding, e.g. MPEG, WebM, OGG, and video files are only accessed in case of a positive search result, which reduces bandwidth in comparison to embedded metadata. Linked files also allow different security permissions to be applied to the crawling and querying processes, so an AI algorithm can be authorised to read metadata without being able to access image content if there are security concerns over data privacy, e.g. illicit facial recognition.
        </p>
        <ul class='note' title='Benefits'>
          <li>Homogenized video metadata from disparate sources;</li>
          <li>Reduced search bandwidth;</li>
          <li>Structured security support;</li>
          <li>Web search engine compatible.</li>
        </ul>
        <aside class='example' title='Remote Maintenance'>
          Visually monitor inaccessible assets, e.g. off-shore wind turbines, using autonomous drones to create a historical video archive that enables remote expert diagnosis of operational issues.
        </aside>
        <aside class='example' title='Flood Monitoring'>
          Aggregate video footage from disparate sources to create a historical video archive that allows water levels to be monitored at different locations over time to help predict flooding.
        </aside>
      </section>
      <section id='vehiclecollision'>
        <h2>Vehicle Collision</h2>
        <p>
          Dashcam footage is searched to automatically identify vehicle collisions from impact acceleration profiles recorded in video metadata. Dashcam manufacturers typically embed metadata in an unpublished format and provide a proprietary video player to allow users to display it. Exporting embedded metadata to a linked file in a web-friendly format enables searchable video archive data to be shared quickly and easily, without affecting evidence integrity, and to be accessed through a common web interface.
        </p>
        <p>
          Vehicles can be automatically monitored using a low-cost dashcam and web-based tools to ensure that collisions are accurately recorded by drivers and that commercial vehicles remain safe and undamaged. Interoperability means that users are not limited to a particular dashcam brand and can share evidence with insurers and the police in a common format without damaging its integrity.
        </p>
        <ul class='note' title='Benefits'>
          <li>Accurate vehicle collision detection;</li>
          <li>Common format for data sharing;</li>
          <li>Web search support;</li>
          <li>Evidence integrity preserved.</li>
        </ul>
        <aside class='example' title='Motor Insurance'>
          Automatically identify vehicle collisions in dashcam footage to provide forensic evidence for a police investigation or motor insurance claim.
        </aside>
      </section>
      <section id='goldentutorial'>
        <h2>Golden Tutorial</h2>
        <p>
          Augmented reality (AR) software is used to control assets or view content in situ at a particular location. For example, nearby street lights can be switched off or on by a service engineer for maintenance purposes, or an architect can see how their structural design integrates with the surrounding landscape at its proposed location before any building work has started.
        </p>
        <p>
          Video footage can be recorded with location, camera orientation and other metadata so AR overlays be generated on demand. Such recordings can be used to demonstrate how AR content is displayed and controlled in order to educate users with a 'golden tutorial', to provide 'proof of action' as evidence of work done for auditing purposes, or to create example data for AR software testing and debugging.
        </p>
        <ul class='note' title='Benefits'>
          <li>Accurate AR video and data recording;</li>
          <li>Improved AR software development.</li>
        </ul>
      </section>
      <section id='virtualguide'>
        <h2>Virtual Guide</h2>
        <p>
          A user triggers an audio track which provides guidance about the local area or instruction for a known object, e.g. Web of Things (WoT) device at that location. The audio timeline is synchronized with events that can display AR content, control WoT devices and display points of interest on a map which provide guidance with real world context by highlighting places or objects of interest and showing possible actions.
        </p>
        <p>
          Users can be guided by a virtual assistant through an area of interest or sequence of actions augmented with AR/VR and WoT devices to visualise events and by an annotated map or model to provide additional geospatial context. Greater insight is given to the user by showing detailed views of the location on a map or internal structure of the identified object using a virtual model.
        </p>
        <ul class='note' title='Benefits'>
          <li>Contextual guidance provided in situ;</li>
          <li>Concurrent operation with AR/VR video;</li>
          <li>Integration with Web of Things.</li>
        </ul>
        <aside class='example' title='Historic Site Guide'>
          Provide an audio guide to visitors at a historic site which is triggered by proximity to a location of interest and synchronized with AR content which reconstructs past buildings and events. The same concept could be implemented in VR to allow remote users to explore the site.
        </aside>
        <aside class='example' title='Medical Tool'>
          Allow a patient to describe their symptoms using AR, e.g. by pointing to a painful area on their own body, which is also modelled as a 'map' to show internal features and display a treatment guide, including any WoT medical devices.
        </aside>
        <aside class='example' title='On-Site Maintenance'>
          Guide a user to control and maintain assets, e.g. infrastructure or machinery. A maintenance engineer could switch off an individual street light in order to replace the bulb using an AR control on the WoT lamppost and request procedural guidance for that particular variant. A farm worker could be guided through operational and diagnostic procedures for agricultural equipment to help rectify a fault while on site.
        </aside>
      </section>
    </section>
    <section class='informative' id='stateoftheart'>
      <h2>State of the Art</h2>
      <p>
        No standard format currently exists by which web browsers can synchronise geolocation data with video. Though many browser-supported formats exist to present the two data streams separately, e.g. MPEG for video and GPX for geolocation, there is no viable synchronisation mechanism for video playback time with geolocation information.
      </p>
      <section id='currentsolutions'>
        <h2>Current Solutions</h2>
        <p>
          Material Exchange Format (MXF) was developed by the Society of Motion Picture and Television Engineers (SMPTE) to synchronise metadata, including geolocation, with audio and video streams using a register of key-length-value (KLV) triples. The breadth of its scope has resulted in interoperability issues, as different vendors implement different parts of the standard, and has produced implementations from high-profile companies which are mutually incompatible. KLVs can also be embedded within MPEG files, though this does not address the synchronisation issue for other web video formats such as WebM.
        </p>
        <p>
          Video camera manufacturers have taken various approaches, resulting in a number of non-standard solutions including embedding geolocation data within the MPEG metadata stream in disparate formats, e.g. Go-Pro Metadata Format (GPMF), or recording a separate geolocation file in a proprietary format alongside the associated video file. From a hardware perspective, a few high-end cameras provide geotagging out of the box and all require an add-on device to support this feature.
        </p>
        <p>
          Geospatial data are not currently accessible in the video Document Object Model (DOM) in HTML nor via video playback APIs in smartphones, e.g. Android, though their host devices are typically equipped with both a video camera and Global Navigation Satellite System (GNSS) receiver capable of capturing the required information.
        </p>
        <p>
          In sharp contrast, still photos have a well-established geotagging standard called Exif, which was published by the Japan Electronic Industries Development Association (JEIDA) in 1995 and defines a metadata tag to embed geolocation data within TIFF and JPEG images. This is widely supported by manufacturers of photographic equipment and software worldwide, including low-end smartphones, making this feature cheap and accessible to the public.
        </p>
      </section>
      <section id='growingrequirements'>
        <h2>Growing Requirements</h2>
        <p>
          Historically, there has been no requirement for a comparable video standard, but the urgency for such a standard is growing fast due to the emerging markets for 'mobile video devices,' e.g. drones, dashcams, body-worn video and helmet cameras, as well as the rise in high-quality video and geolocation support in the global smartphone market.
        </p>
      </section>
      <section id='accessiblestandard'>
        <h2>Accessible Standard Opportunity</h2>
        <p>
          Using current W3C recommendations, it is possible for a competent programmer to synchronise video-geolocation 'metadata' with a &lt;video&gt; element using a &lt;track&gt; child element. However, this is a non-trivial development task which requires an understanding of the video DOM events and Javascript file handling, making it inaccessible to the vast majority of web users. In addition, video map tracks are a clearly identified metadata subclass, which could be isolated in a similar way to video text tracks.
        </p>
        <p>
          Establishing a standard file format would allow interoperability and information sharing between the public, the emergency services, police and other mobile video device users, e.g. drone pilots, giving cheaper and easier access to this important source of information. If web browsers supported video geotagging natively using this file format, it would also become accessible to most web users. Current low-end smartphones already provide suitable hardware to concurrently capture video and geolocation streams, which would make this technology easily accessible to the general public, and encourage the user and developer communities to grow rapidly.
        </p>
      </section>
    </section>
    <section class='informative' id='proposedsolution'>
      <h2>Proposed Solution</h2>
      <p>
        This proposal constitutes a lightweight markup language to synchronise video with geolocation data for display on electronic maps, e.g. OpenStreetMaps. It offers presentational control of the map display, e.g. pan and zoom, and annotation to highlight map features to the viewer, e.g. markers and labels.
      </p>
      <p>
        WebVMT (Web Video Map Tracks) format is intended for marking up external map track resources, and its main use is for files synchronising video content with an annotated map presentation. Ideas have been borrowed from existing W3C formats, including WebVTT's HTML binding and its block and cue structures, and SVG's approach to drawing and interpolation, in order to display output on an electronic map.
      </p>
      <p>
        The format mimics WebVTT's structure and syntax for video synchronisation, with cue details listed in an accessible text-based file linked to the <code>&lt;video&gt;</code> DOM element by a child <code>&lt;track&gt;</code> element in an HTML document.
      </p>
      <pre class='nohighlight example' title='WebVMT Basic HTML'>
&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;WebVMT Basic Example&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;!-- Video display --&gt;
    &lt;video controls width="640" height="360"&gt;
      &lt;source src="video.mp4" type="video/mp4"&gt;
      &lt;track src="maptrack.vmt" kind="metadata" for="vmt-map" tileurl="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png?key=VALID_OSM_KEY"&gt;
      Your browser does not support the video tag.
    &lt;/video&gt;
    &lt;!-- Map display --&gt;
    &lt;div id="vmt-map" style="height: 360px; width:640px;"&gt;&lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
      </pre>
      <p>
        The VMT (Video Map Track) format file, e.g. maptrack.vmt, contains the map cues associated with the video, e.g. video.mp4.
      </p>
      <p class='ednote'>
        The meaning of <code>for</code> and <code>tileurl</code> attributes for user agents is an open question. Initial solutions can be built using Javascript, with existing map libraries such as Leaflet, though the vision is that future user agents will handle map rendering in the longer term.
      </p>
      <section id='mapcues'>
        <h2>Map Cues</h2>
        <p>
          Map cues display their payload between a start time and end time. The end cue time may be omitted to represent an unknown time.
        </p>
        <section id='helloworld'>
          <h2>Hello World</h2>
          <p>
            Here is a sample VMT file with a cue highlighting Tower Bridge in London on a static map.
          </p>
          <pre class='nohighlight example' title='Tower Bridge VMT'>
WEBVMT

MEDIA
url:TowerBridge.mp4
mimetype:video/mp4

MAP
lat:51.506 lng:-0.076
rad:250

00:00:02.000 --&gt; 00:00:05.000
{ "moveto":
  { "lat": 51.504362, "lng": -0.076153 }
}
{ "lineto":
  { "lat": 51.506646, "lng": -0.074651 }
}
          </pre>
        </section>
        <section id='mappresentation'>
          <h2>Map Presentation</h2>
          <p>
            Cues also allow dynamic presentation to pan and zoom the map. This example focusses attention on the Tower of London.
          </p>
          <p>
            Cues without end times are displayed until the end of the video.
          </p>
          <pre class='nohighlight example' title='Tower of London VMT'>
WEBVMT

MEDIA
url:../movies/TowerOfLondon.webm
mimetype:video/webm

MAP
lat:51.162 lng:-0.143
rad:20000

00:00:03.000 --&gt;
{ "panto":
  { "lat": 51.508, "lng": -0.077, "end": "00:00:05.000" }
}

00:00:06.000 --&gt;
{ "zoom":
  { "rad": 250 }
}
          </pre>
        </section>
      </section>
      <section id='comments'>
        <h2>Comments</h2>
        <p>
          Comments are blocks that are preceded by a blank line, start with the word <code>NOTE</code> (followed by a space or newline), and end at the first blank line.
        </p>
        <section id='commentblock'>
          <h2>Comment Block</h2>
          <p>
            Comment block format is identical to <a data-cite='WEBVTT#introduction-comments'>WebVTT</a>.
          </p>
          <pre class='nohighlight example' title='Tower Landmarks VMT'>
WEBVMT

NOTE Associated video

MEDIA
url:/home/myuser/movies/TowerLandmarks.ogg
mimetype:video/ogg

NOTE Map config

MAP
lat:51.506 lng:-0.076
rad:500

NOTE Tower Bridge

00:00:01.000 --&gt; 00:00:05.000
{ "moveto":
  { "lat": 51.504362, "lng": -0.076153 }
}
{ "lineto":
  { "lat": 51.506646, "lng": -0.074651 }
}

NOTE City Hall

00:00:02.000 --&gt;
{ "circle":
  { "lat": 51.504789, "lng": -0.078642, "rad": 20 }
}

NOTE Tower Of London
This line is also part of the comment

00:00:03.000 --&gt; 00:00:04.000
{ "polygon":
  { "perim":
    [ { "lat": 51.507193, "lng": -0.074844 },
      { "lat": 51.508756, "lng": -0.074716 },
      { "lat": 51.509036, "lng": -0.075638 },
      { "lat": 51.508929, "lng": -0.077162 },
      { "lat": 51.507727, "lng": -0.077848 },
      { "lat": 51.507220, "lng": -0.075767 }
    ]
  }
}
          </pre>
        </section>
      </section>
      <section id='styling'>
        <h2>Styling</h2>
        <p>
          Display style is controlled by CSS, which may be embedded in HTML or within the VMT file.
        </p>
        <section id='cssstylehtml'>
          <h2>CSS Style in HTML</h2>
          <p>
            In this example, an HTML page has a CSS style sheet in a <code>&lt;style&gt;</code> element that styles map cues for the video, e.g. drawing lines in red.
          </p>
          <pre class='nohighlight example' title='Style Within HTML'>
&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;WebVMT Style Example&lt;/title&gt;
    &lt;style&gt;
      video::cue {
        stroke: red;
        stroke-opacity: 0.9;
      }
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;video controls width="640" height="360"&gt;
      &lt;source src="video.mp4" type="video/mp4"&gt;
      &lt;track src="maptrack.vmt" kind="metadata" for="vmt-map" tileurl="https://api2.ordnancesurvey.co.uk/mapping_api/v1/service/zxy/EPSG%3A3857/Outdoor%203857/\{z}/{x}/{y}.png?key=VALID_OS_KEY"&gt;
      Your browser does not support the video tag.
    &lt;/video&gt;
    &lt;div id="vmt-map" style="height: 360px; width:640px;"&gt;&lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
          </pre>
        </section>
        <section id='cssstyleblock'>
          <h2>CSS Style Block</h2>
          <p>
            Style block format is similar to <a data-cite='WEBVTT#styling'>WebVTT</a>.
          </p>
          <p>
            CSS style sheets can also be embedded in WebVMT files themselves. Style blocks are placed after any headers but before the first cue, and start with the word <code>STYLE</code>.
          </p>
          <p>
            Comment blocks can be interleaved with style blocks.
          </p>
          <pre class='nohighlight example' title='Greenwich Meridian VMT'>
WEBVMT

MEDIA
url:http://example.com/movies/Greenwich.mp4
mimetype:video/mp4

MAP
lat:51.478 lng:-0.001
rad:50

STYLE
::cue {
  stroke: red;
}

NOTE Comments are allowed between style blocks

STYLE
::cue {
  stroke-opacity: 0.9;
}

NOTE Prime Meridian marker

00:00:00.000 --&gt;
{ "moveto":
  { "lat":51.477901, "lng": -0.001466 }
}
{ "lineto":
  { "lat":51.477946, "lng": -0.001466 }
}

NOTE Style blocks may not appear after the first cue
          </pre>
        </section>
      </section>
      <section id='datasynchronization'>
        <h2>Data Synchronization</h2>
        <p>
          Arbitrary data may be associated with a <a>WebVMT cue</a> using a <code>sync</code> command, in a similar fashion to the GPX <code>&lt;extension&gt;</code> element.
        </p>
        <pre class='nohighlight example' title='AI Training VMT'>
WEBVMT

NOTE Associated video

MEDIA
url:Animals.mp4
mimetype:video/mp4

NOTE Map config

MAP
lat:51.1618 lng:-0.1428
rad:200

NOTE Cat, top left, after 5 secs until 25 secs

00:00:05.000 —> 00:00:25.000
{ “sync”: { “type”: “org.ogc.geoai.example”, “data”:
  { “animal”:”cat”, “frame-zone”:”top-left" }
} }

NOTE Dog, mid right, after 10 secs until 40 secs

00:00:10.000 —> 00:00:40.000
{ “sync”: { “type”: “org.ogc.geoai.example”, “data”:
  { “animal”: ”dog”, “frame-zone”: ”middle-right" }
} }
        </pre>
      </section>
      <section id='interpolation'>
        <h2>Interpolation</h2>
        <p>
          Data values may be interpolated using an <code>interp</code> command, in a similar way to the <code>&lt;animate&gt;</code> element in <a data-cite='SVG11' data-no-xref=''>SVG</a>.
        </p>
        <p>
          Sensor data can be interpolated between sample points to provide intermediate values where necessary, while retaining the original source data sample values.
        </p>
        <p>
          Three interpolation schemes are supported:
          <ul>
            <li><b>Step:</b> the value remains constant until the next sample time, e.g. vehicle gear selection - see <a href='#stepinterp'></a>;</li>
            <li><b>Linear:</b> the value is linearly interpolated to the next sample time, e.g. temperature - see <a href='#linearinterp'></a>;</li>
            <li><b>Discrete:</b> the value is only valid instanteously at the sample time, e.g. headcount in a video frame - see <a href='#discreteinterp'></a>.</li>
          </ul>
        </p>
        <section id='stepinterpolation'>
          <h2>Step Interpolation</h2>
          <p>
            A stepwise-interpolated value remains constant until the next sample time, e.g. vehicle gear selection
            <figure id="stepinterp">
              <img src="figures/StepInterp.png" alt="Step Interpolation" />
              <figcaption>Step interpolation.</figcaption>
            </figure>
          </p>
          <pre class='nohighlight example' title='Step Interpolation VMT'>
WEBVMT

NOTE Required blocks omitted for clarity

NOTE Step interpolation of sensor1 data
     gear = 4 after 2 secs until 6 secs

00:00:02.000 --&gt; 00:00:06.000
{ "sync":
  { "type": "org.webvmt.example", "id": "sensor1", "data":
    { "gear": "4" }
  }
}

NOTE Step interpolation of sensor1 data
     gear = 5 after 6 secs until 9 secs

00:00:06.000 --&gt; 00:00:09.000
{ "sync":
  { "id": "sensor1", "data":
    { "gear": "5" }
  }
}
          </pre>
        </section>
        <section id='linearinterpolation'>
          <h2>Linear Interpolation</h2>
          <p>
            A linearly-interpolated value changes to a final value at the next sample time in direct proportion to the elapsed sample interval, e.g. temperature.
            <figure id="linearinterp">
              <img src="figures/LinearInterp.png" alt="Linear Interpolation" />
              <figcaption>Linear interpolation.</figcaption>
            </figure>
          </p>
          <pre class='nohighlight example' title='Linear Interpolation VMT'>
WEBVMT

NOTE Required blocks omitted for clarity

NOTE Linear interpolation of sensor2 data
     temperature = 14 -> 16 after 4 secs until 6 secs

00:00:04.000 --&gt; 00:00:06.000
{ "sync":
  { "type": "org.webvmt.example", "id": "sensor2", "data":
    { "temperature": "14" }
  }
}
{ "interp": { "to":
  { "data": { "temperature": "16" } }
} }

NOTE Linear interpolation of sensor2 data
     temperature = 16 -> 19 after 6 secs until 9 secs

00:00:06.000 --&gt; 00:00:09.000
{ "sync":
  { "id": "sensor2" }
}
{ "interp": { "to":
  { "data": { "temperature": "19" } }
} }
          </pre>
        </section>
        <section id='discreteinterpolation'>
          <h2>Discrete Interpolation</h2>
          <p>
            A discretely-interpolated value is only valid instanteously at the sample time, e.g. headcount in a video frame.
            <figure id="discreteinterp">
              <img src="figures/DiscreteInterp.png" alt="Discrete Interpolation" />
              <figcaption>Discrete interpolation.</figcaption>
            </figure>
          </p>
          <pre class='nohighlight example' title='Discrete Interpolation VMT'>
WEBVMT

NOTE Required blocks omitted for clarity

NOTE Discrete interpolation of sensor3 data
     headcount = 12 at 4 secs

00:00:04.000 --&gt; 00:00:04.000
{ "sync":
  { "type": "org.webvmt.example", "id": "sensor3", "data":
    { "headcount": "12" }
  }
}

NOTE Discrete interpolation of sensor3 data
     headcount = 34 at 6 secs

00:00:06.000 --&gt; 00:00:06.000
{ "sync":
  { "id": "sensor3", "data":
    { "headcount": "34" }
  }
}
          </pre>
        </section>
        <section id='livestreaminterpolation'>
          <h2>Live Stream Interpolation</h2>
          <p>
            Live streams can be recorded with interpolation using unbounded cues, i.e. a cue with an unknown end time.
          </p>
          <p>
            In this example, an identical net result to the <a href="#stepinterpolation">previous step interpolation example</a>  is produced but without knowledge of any future data values during the live capture process.
          </p>
          <pre class='nohighlight example' title='Live Step Interpolation VMT'>
WEBVMT

NOTE Required blocks omitted for clarity

NOTE Step interpolation of live1 data

{ "sync":
  { "type": "org.webvmt.example", "id": "live1", "data":
    { "gear": "4" }
  }
}

NOTE Step interpolation of live1 data
     gear = 5 after 6 secs until next update

00:00:06.000 --&gt;
{ "sync":
  { "id": "live1", "data":
    { "gear": "5" }
  }
}

NOTE End (step) interpolation of live1 data
     gear = 5 at 9 secs

00:00:09.000 --&gt; 00:00:09.000
{ "sync":
  { "id": "live1", "data":
    { "gear": "5" }
  }
}
          </pre>
          <p>
            In the next example, an identical net result to the <a href="#linearinterpolation">previous linear interpolation example</a> is produced but without knowledge of any future data values during the live capture process.
          </p>
          <pre class='nohighlight example' title='Live Linear Interpolation VMT'>
WEBVMT

NOTE Required blocks omitted for clarity

NOTE Linear interpolation of live2 data
     temperature = 14 after 4 secs until next update

00:00:04.000 --&gt;
{ "sync":
  { "type": "org.webvmt.example", "id": "live2", "data":
    { "temperature": "14" }
  }
}
{ "interp": { "end": "00:00:06.000", "to":
  { "data": { "temperature": "16" } }
} }

NOTE Linear interpolation of live2 data
     temperature = 16 after 6 secs until next update

00:00:06.000 --&gt;
{ "sync":
  { "id": "live2"}
}
{ "interp": { "end": "00:00:09.000", "to":
  { "data": { "temperature": "19" } }
} }

NOTE End (linear) interpolation of live2 data
     temperature = 19 at 9 secs

00:00:09.000 --&gt; 00:00:09.000
{ "sync":
  { "id": "live2", "data":
    { "temperature": "19" }
  }
}
          </pre>
          <p class='note' title='Interpolation During Live Capture'>
            Values may not be interpolated <i>during</i> capture as future data are unknown, e.g. for linear interpolation, though can be correctly interpolated <i>after</i> capture, once end values are known during subsequent playbacks.
          </p>
        </section>
        <section id='interpolatedpath'>
          <h2>Interpolated Path</h2>
          <p>
            A <a>WebVMT path</a> describes the trajectory of a moving object which consists of a timed sequence of locations. Path location may be interpolated over time to calculate the distance travelled.
          </p>
          <p>
            The <code>path</code> attribute may be set to identify an individual path. This allows a path to be styled, e.g. colour, and the speed and distance attributes to be identified during playback.
          </p>
          <p>
            In this example, an interpolated path is traced from London to Brighton:
          </p>
          <pre class='nohighlight example' title='London to Brighton VMT'>
WEBVMT

NOTE Associated video

MEDIA
url:LondonBrighton.mp4
mimetype:video/mp4

NOTE Map config

MAP
lat:51.1618 lng:-0.1428
rad:20000

NOTE London overview

00:00:01.000 --&gt;
{ "panto":
  { "lat": 51.4952, "lng": -0.1441 }
}

00:00:02.000 --&gt;
{ "zoom":
  { "rad": 10000 }
}

NOTE From London Victoria...

00:00:03.000 --&gt;
{ "panto":
  { "lat": 50.830553, "lng": -0.141706, "end": "00:00:25.000" }
}
{ "moveto":
  { "lat": 51.494477, "lng": -0.144753, "path": "cam1" }
}
{ "lineto":
  { "lat": 51.155958, "lng": -0.16089, "path": "cam1", "end": "00:00:10.000" }
}

NOTE ...via Gatwick Airport...

00:00:10.000 --&gt;
{ "lineto":
  { "lat": 50.830553, "lng": -0.141706, "path": "cam1", "end": "00:00:25.000" }
}

NOTE ...to Brighton (at 00:00:25.000)

00:00:27.000 --&gt;
{ "zoom":
  { "rad": 20000 }
}
          </pre>
        </section>
        <section id='interpolatedannotation'>
          <h2>Interpolated Annotation</h2>
          <p>
            Interpolation can also be applied to the attributes of a <a>WebVMT command</a> and a map annotation may be animated in this way.
          </p>
          <p>
            This example tracks a drone with a circular 10-meter safety zone around it.
          </p>
          <pre class='nohighlight example' title='Safe Drone VMT'>
WEBVMT

NOTE Associated video

MEDIA
url:SafeDrone.mp4
mimetype:video/mp4

NOTE Map config

MAP
lat:51.0130 lng:-0.0015
rad:1000

NOTE Drone starts at (51.0130, -0.0015)

00:00:05.000 --&gt;
{ "panto":
  { "lat": 51.0070, "lng": -0.0020, "end": "00:00:25.000" }
}
{ "moveto":
  { "lat": 51.0130, "lng": -0.0015, "path": "drone1" }
}
{ "lineto":
  { "lat": 51.0090, "lng": -0.0017, "path": "drone1", "end": "00:00:10.000" }
}

NOTE Safety zone

00:00:05.000 --&gt; 00:00:10.000
{ "circle":
  { "lat": 51.0130, "lng": -0.0015, "rad": 10 }
}
{ "interp":
  { "to": { "lat": 51.0090, "lng": -0.0017 } }
}

NOTE Drone arrives at (51.0090, -0.0017)

00:00:10.000 --&gt;
{ "lineto":
  { "lat": 51.0070, "lng": -0.0020, "path": "drone1", "end": "00:00:25.000" }
}
{ "circle":
  { "lat": 51.0090, "lng": -0.0017, "rad": 10 }
}
{ "interp":
  { "end": "00:00:25.000", "to": { "lat": 51.0070, "lng": -0.0020 } }
}

NOTE Drone ends at (51.0070, -0.0020)
          </pre>
        </section>
      </section>
      <section id='youtubeintegration'>
        <h2>YouTube Integration</h2>
        <p>
          Embedded YouTube content can be displayed using an <code>&lt;iframe&gt;</code> element, specifying the unique 10-character content identifier for the posted video, using the official <a href="https://developers.google.com/youtube/iframe_api_reference">YouTube IFrame API</a> with the Javascript API enabled.
        </p>

        <section id='helloyoutube'>
          <h2>Hello YouTube</h2>
          <p>
            A child <code>&lt;track&gt;</code> pseudo-element within the <code>&lt;iframe&gt;</code> links it with WebVMT using the same syntax as for the <code>&lt;video&gt;</code> DOM element.
          </p>
          <pre class='nohighlight example' title='WebVMT YouTube HTML'>
&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;WebVMT YouTube Example&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;!-- Video display --&gt;
    &lt;iframe src="http://www.youtube.com/embed/YOUTUBE_VIDEO_ID?enablejsapi=1" width="640" height="360" frameborder="0"&gt;
      &lt;track src="maptrack.vmt" kind="metadata" for="vmt-map" tileurl="mapbox://styles/mapbox/streets-v9"&gt;
    &lt;/iframe&gt;
    &lt;!-- Map display --&gt;
    &lt;div id="vmt-map" style="height: 360px; width:640px;"&gt;&lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
          </pre>
          <p>
            Note that the <code>&lt;track&gt;</code> pseudo-element is actually replaced by the <code>&lt;iframe&gt;</code> content when the page is loaded.
          </p>
          <p>
            The <code>url</code> in the <code>MEDIA</code> block should match the <code>src</code> attribute of the <code>&lt;iframe&gt;</code> element without the query.
          </p>
          <pre class='nohighlight example' title='YouTube VMT Fragment'>
WEBVMT

NOTE Associated YouTube video

MEDIA
url:http://www.youtube.com/embed/YOUTUBE_VIDEO_ID
mimetype:video/mp4
          </pre>
        </section>
      </section>
    </section>
    <section id='conformance'>
      <!--h2>Conformance</h2>
      <p>
        All diagrams, examples, and notes in this specification are non-normative, as are all sections explicitly marked non-normative. Everything else in this specification is normative.
      </p>
      <p>
        The key words "MUST", "MUST NOT", "SHOULD", "SHOULD NOT", "MAY", and "OPTIONAL" in the normative parts of this document are to be interpreted as described in RFC2119. The key word "OPTIONALLY" in the normative parts of this document is to be interpreted with the same normative meaning as "MAY" and "OPTIONAL". For readability, these words do not appear in all uppercase letters in this specification.
      </p>
      <p>
        Requirements phrased in the imperative as part of algorithms (such as "strip any leading space characters" or "return false and abort these steps") are to be interpreted with the meaning of the key word ("must", "should", "may", etc) used in introducing the algorithm.
      </p>
      <p>
        Conformance requirements phrased as algorithms or specific steps may be implemented in any manner, so long as the end result is equivalent. (In particular, the algorithms defined in this specification are intended to be easy to follow, and not intended to be performant.)
      </p-->
      <section id='conformance-classes'>
        <h2>Conformance classes</h2>
        <p>
          This specification describes the conformance criteria for user agents (relevant to implementors) and <a>WebVMT files</a> (relevant to authors and authoring tool implementors).
        </p>
        <p class='note'>
          <a href='#syntax'>Syntax</a> defines what consists of a valid <a>WebVMT file</a>. Authors need to follow the requirements therein, and are encouraged to use a conformance checker. <a href='#parsing'>Parsing</a> defines how user agents are to interpret a file labelled as <a href='#text-vmt'>text/vmt</a>, for both valid and invalid <a>WebVMT files</a>. The parsing rules are more tolerant to author errors than the syntax allows, in order to provide for extensibility and to still render cues that have some syntax errors.
        </p>
        <aside class='example' title='Conformance Error'>
          For example, the parser will create two cues even if the blank line between them is skipped. This is clearly a mistake, so a conformance checker will flag it as an error, but it is still useful to render the cues to the user.
        </aside>
        <p>
          User agents fall into several (possibly overlapping) categories with different conformance requirements.
        </p>
        <dl>
          <dt>
            <dfn class='export'>User agents that support scripting</dfn>
          </dt>
          <dd>
            All processing requirements in this specification apply. The user agent must also be conforming implementations of the IDL fragments in this specification, as described in the <a data-cite='WEBIDL-1' data-no-xref=''>Web IDL</a> specification.
          </dd>
          <dt>
            <dfn class='export'>User agents with no scripting support</dfn>
          </dt>
          <dd>
            All processing requirements in this specification apply, except those in <a href='#plannedinterfaces'>Planned Interfaces</a>.
            <!--except those in §6.5 WebVTT cue text DOM construction rules and §9 API.-->
          </dd>
          <dt>
            <dfn class='export'>User agents that do not support CSS</dfn>
          </dt>
          <dd>
            All processing requirements in this specification apply, except parts of <a href='#parsing'>Parsing</a> that relate to stylesheets and CSS, and all of <!--<a href='#rendering'>Rendering</a> and --><a href='#css-extensions'>CSS Extensions</a>. The user agent must instead only render the <a>WebVMT cue</a> in an appropriate manner <!--and specifically support the color classes defined in §5 Default classes for WebVTT Caption or Subtitle Cue Components-->. Any other styling instructions are optional.
          </dd>
          <dt>
            <dfn>User agents that do not support a full HTML CSS engine</dfn>
          </dt>
          <dd>
            All processing requirements in this specification apply<!--, including the color classes defined in §5 Default classes for WebVTT Caption or Subtitle Cue Components-->. However, the user agent will need to apply the CSS related features in <a href='#parsing'>Parsing</a>, <!--<a href='#rendering'>Rendering</a> -->and <a href='#css-extensions'>CSS Extensions</a> in such a way that the rendered results are equivalent to what a full CSS supporting renderer produces.
          </dd>
          <dt>
            <dfn class='export'>User agents that support a full HTML CSS engine</dfn>
          </dt>
          <dd>
            All processing requirements in this specification apply. However, only a limited set of CSS styles is allowed because <a>user agents that do not support a full HTML CSS engine</a> will need to implement CSS functionality equivalents. User agents that support a full CSS engine must therefore limit the CSS styles they apply for WebVMT so as to enable identical rendering without bleeding in extra CSS styles that are beyond the WebVMT specification.
          </dd>
          <dt>
            <dfn class='export'>Conformance checkers</dfn>
          </dt>
          <dd>
            Conformance checkers must verify that a <a>WebVMT file</a> conforms to the applicable conformance criteria described in this specification. The term "validator" is equivalent to conformance checker for the purpose of this specification.
          </dd>
          <dt>
            <dfn class='export'>Authoring tools</dfn>
          </dt>
          <dd>
            Authoring tools must generate conforming <a>WebVMT files</a>. Tools that convert other formats to WebVMT are also considered to be authoring tools.
          </dd>
          <dd>
            When an authoring tool is used to edit a non-conforming <a>WebVMT file</a>, it may preserve the conformance errors in sections of the file that were not edited during the editing session (i.e. an editing tool is allowed to round-trip erroneous content). However, an authoring tool must not claim that the output is conformant if errors have been so preserved.
          </dd>
        </dl>
      </section>
      <section id='unicode-normalization'>
        <h2>Unicode normalization</h2>
        <p>
          Implementations of this specification must not normalize Unicode text during processing.
        </p>
        <aside class='example' title='Unicode Matching'>
          For example, a cue with an identifier consisting of the characters U+0041 LATIN CAPITAL LETTER A followed by U+030A COMBINING RING ABOVE (a decomposed character sequence), or the character U+212B ANGSTROM SIGN (a compatibility character), will not match a selector targeting a cue with an ID consisting of the character U+00C5 LATIN CAPITAL LETTER A WITH RING ABOVE (a precomposed character).
        </aside>
      </section>
    </section>
    <section class='informative' id='datamodel'>
      <h2>Data Model</h2>
      <p class='ednote'>
        The data model of WebVMT consists of four key elements: the linked media file, the video viewport, cues, and the map viewport. The linked media file contains audio or video data with which cues are synchronized. The video viewport is the rendering area for video output. Cues are containers consisting of a set of metadata lines. The map viewport is the rendering area for metadata output, for example graphical annotations overlaid on an online map.
      </p>
      <section class='informative' id='overview'>
        <h2>Overview</h2>
        <p>
          The WebVMT file is a container file for chunks of data that are time-aligned with a video or audio resource. It can therefore be regarded as a serialisation format for time-aligned data.
        </p>
        <p>
          A WebVMT file starts with a header and then contains a series of data blocks. If a data block has a start time, it is called a WebVMT cue. A comment is another kind of data block.
        </p>
        <p>
          A WebVMT file carries cues which are identified as <a data-cite='HTML51/semantics-embedded-content.html#attr-valuedef-track-kind-metadata'>metadata</a> and specified in the <a data-cite='HTML51/semantics-embedded-content.html#element-attrdef-track-kind'>kind</a> attribute of the <a data-cite='HTML51/semantics-embedded-content.html#the-track-element'>track</a> element in the <a data-cite='HTML51' data-no-xref=''>HTML</a> specification.
        </p>
        <p>
          The data kind of a WebVMT file is externally specified, such as in a HTML file’s <a data-cite='HTML51/semantics-embedded-content.html#the-track-element'>track</a> element. The environment is responsible for interpreting the data correctly.
        </p>
        <p>
          A <a>WebVMT cue</a> is rendered as an overlay on top of the map viewport.
        </p>
      </section>
      <section id='webvmtcues'>
        <h2>WebVMT Cues</h2>
        <p>
          A <dfn>WebVMT cue</dfn> is a <a data-cite='HTML51/semantics-embedded-content.html#text-track-cue'>text track cue</a> that additionally consists of the following:
        </p>
        <dl>
          <dt>
            A <dfn class='export'>cue text</dfn>
          </dt>
          <dd>
            The raw text of the cue which is interpreted as time-aligned metadata, and rules for its interpretation.
          </dd>
        </dl>
        <p class='note' title='Cue End Time Omission'>
          A <a>WebVMT cue</a> without an end time indicates that the cue is an <a data-cite='HTML51/semantics-embedded-content.html#unbounded-text-track-cue'>unbounded text track cue</a>, for example during live streaming when the time of the next data sample is unknown or when the duration of the media is unknown.
        </p>
      </section>
      <section id='webvmtlocation'>
        <h2>WebVMT Location</h2>
        <p>
          A <dfn>WebVMT location</dfn> consists of:
        </p>
        <dl>
          <dt>
            A <dfn class='export'>location latitude</dfn>
          </dt>
          <dd>
            The latitude in degrees of the location.
          </dd>
          <dt>
            A <dfn class='export'>location longitude</dfn>
          </dt>
          <dd>
            The longitude in degrees of the location.
          </dd>
          <dt>
            A <dfn class='export'>location altitude</dfn>
          </dt>
          <dd>
            Optionally, the altitude in meters of the location.
          </dd>
        </dl>
        <p class='note' title='Co-ordinate Reference System'>
          Location information is provided in terms of World Geodetic System coordinates, WGS84.
        </p>
      </section>
      <section id='webvmtmap'>
        <h2>WebVMT Map</h2>
        <p>
          A <dfn>WebVMT map</dfn> is the map viewport and provides a rendering area for <a>WebVMT cues</a>.
        </p>
        <p>
          A <a>WebVMT map</a> consists of:
        </p>
        <dl>
          <dt>
            A <dfn>map center location</dfn>
          </dt>
          <dd>
            The <a>WebVMT location</a> at the center of the map.
          </dd>
          <dt>
            A <dfn>map zoom radius</dfn>
          </dt>
          <dd>
            The radius in meters of the minimum area visible from the <a>map center location</a>.
          </dd>
          <dt>
            A <dfn>map interface object</dfn>
          </dt>
          <dd>
            The control interface object for the map.
          </dd>
          <p class='note' title='Map Interface Object'>
            The precise format of the <a>map interface object</a> is implementation dependent, for example OpenLayers API or Leaflet API.
          </p>
          <p>
            For parsing, we also need the following:
          </p>
          <dt>
            A <dfn>text track map</dfn>
          </dt>
          <dd>
            A <a>WebVMT map</a> associated with the text track.
          </dd>
          <dd>
            By default, the <a>text track map</a> is set to null.
          </dd>
          <!--dt>
            A <dfn>text track map identifier</dfn>
          </dt>
          <dd>
            An identifier for the <a>WebVMT map</a>.
          </dd-->
        </dl>
      </section>
      <section id='webvmtmediafile'>
        <h2>WebVMT Media</h2>
        <p>
          A <dfn>WebVMT media</dfn> is the linked media data with which <a>WebVMT cues</a> are synchronized, for example audio or video.
        </p>
        <p class='note' title='Search Engines'>
          A <a>WebVMT media</a> enables a web crawler to rapidly search media metadata by providing sufficient information to construct a time-metadata index of the linked media file without opening it. Search engine data throughput is reduced as only matching media files selected by the user need be read, and non-matching media files are not accessed at all. Care should be taken to maintain <a>WebVMT media</a> details correctly, for example when a media file is renamed.
        </p>
        <p>
          A <a>WebVMT media</a> consists of:
        </p>
        <dl>
          <dt>
            A <dfn>media URL</dfn>
          </dt>
          <dd>
            The URL of the linked media file.
          </dd>
          <p class='note' title='Media URL'>
            A null <a>media URL</a> indicates that no linked media file exists.
          </p>
          <dt>
            A <dfn>media MIME type</dfn>
          </dt>
          <dd>
            The MIME type of the linked media file.
          </dd>
          <p class='note' title='Media MIME Type'>
            A null <a>media MIME type</a> indicates that no linked media file exists.
          </p>
          <dt>
            A <dfn>media start time</dfn>
          </dt>
          <dd>
            The global time and date at which the linked media file begins.
          </dd>
          <p class='note' title='Media Start Time'>
            The <a>media start time</a> allows multiple <a>WebVMT files</a> to be aggregated. A null <a>media start time</a> indicates that no start time is associated, for example in the case of an animation.
          </p>
          <dt>
            A <dfn>media path</dfn>
          </dt>
          <dd>
            The path identifier which uniquely identifies the moving object capturing the linked media file.
          </dd>
          <p class='note' title='Media Path'>
            A null <a>media path</a> indicates that no moving object is associated, for example when no linked media file exists.
          </p>
        </dl>
      </section>
      <section id='commandstructures'>
        <h2>WebVMT Command Structures</h2>
        <p>
          A <dfn>WebVMT command</dfn> is an instruction to display WebVMT metadata content.
        </p>
        <p>
          A <a>WebVMT command</a> consists of one of the following components:
          <ul>
            <li>
              A <a>WebVMT map control</a> command;
            </li>
            <li>
              A <a>WebVMT zone fragment</a> command;
            </li>
            <li>
              A <a>WebVMT path fragment</a> command;
            </li>
            <li>
              A <a>WebVMT synchronized data</a> command.
            </li>
          </ul>
        </p>
        <p class='note' title='Command Execution Order'>
          <a>WebVMT commands</a> are executed in order from first to last in the <a>WebVMT file</a>.
        </p>
        <section id='mapcontrols'>
          <h2>Map Controls</h2>
          <p>
            A <dfn>WebVMT map control</dfn> command controls map presentation.
          </p>
          <p>
            A <a>WebVMT map control</a> command consists of one of the following components:
          </p>
          <ul>
            <li>
              A <a>WebVMT pan</a> command.
            </li>
            <li>
              A <a>WebVMT zoom</a> command.
            </li>
          </ul>
          <p>
            A <dfn>WebVMT pan</dfn> is a command to set the location of the map center.
          </p>
          <p>
            A <a>WebVMT pan</a> consists of:
          </p>
          <dl>
            <dt>
              A <dfn>pan location</dfn>
            </dt>
            <dd>
              The <a>WebVMT location</a> to which the <a>map center location</a> pans.
            </dd>
            <dt>
              A <dfn>pan start time</dfn>
            </dt>
            <dd>
              The time at which the map starts panning towards the <a>pan location</a>.
            </dd>
            <dd>
              The <a>pan start time</a> is set to the cue start time.
            </dd>
            <dt>
              A <dfn>pan end time</dfn>
            </dt>
            <dd>
              The time at which the <a>map center location</a> equals the <a>pan location</a>.
            </dd>
            <dd>
              The <a>pan end time</a> may be defined as an absolute value, or calculated relative to the <a>pan start time</a> using a duration.
            </dd>
          </dl>
          <p>
            A <dfn>WebVMT zoom</dfn> is a command to set the level of detail of the map.
          </p>
          <p>
            A <a>WebVMT zoom</a> consists of:
          </p>
          <dl>
            <dt>
              A <dfn class='export'>zoom radius</dfn>
            </dt>
            <dd>
              The radius in meters of the <a>map zoom radius</a>.
            </dd>
          </dl>
        </section>
        <section id='shapeannotations' id='zones'>
          <h2>Zones</h2>
          <p>
            A <dfn>WebVMT zone</dfn> consists of all the <a>WebVMT zone fragments</a> with the same <dfn>zone identifier</dfn>.
          </p>
          <p>
            A <dfn>WebVMT zone fragment</dfn> command consists of one of the following components:
          </p>
          <ul>
            <li>
              A <a>WebVMT circle</a> command.
            </li>
            <li>
              A <a>WebVMT polygon</a> command.
            </li>
          </ul>
          <p>
            A <dfn>WebVMT circle</dfn> is a command to annotate a circular area to the map.
          </p>
          <p>
            A <a>WebVMT circle</a> consists of:
          </p>
          <dl>
            <dt>
              A <a>zone identifier</a>
            </dt>
            <dd>
              The identifier shared by all the <a>WebVMT zone fragments</a> in the <a>WebVMT zone</a>.
            </dd>
            <dd>
              By default, the <a>zone identifier</a> is set to null.
            </dd>
            <dt>
              A <dfn class='export'>circle location</dfn>
            </dt>
            <dd>
              The <a>WebVMT location</a> of the circle center.
            </dd>
            <dt>
              A <dfn class='export'>circle radius</dfn>
            </dt>
            <dd>
              The radius in meters of the circle.
            </dd>
          </dl>
          <p>
            A <dfn>WebVMT polygon</dfn> is a command to annotate a polygonal area to the map.
          </p>
          <p>
            A <a>WebVMT polygon</a> consists of:
          </p>
          <dl>
            <dt>
              A <a>zone identifier</a>
            </dt>
            <dd>
              The identifier shared by all the <a>WebVMT zone fragments</a> in the <a>WebVMT zone</a>.
            </dd>
            <dd>
              By default, the <a>zone identifier</a> is set to null.
            </dd>
            <dt>
              A list of <a>WebVMT locations</a> defining the polygon vertices.
            </dt>
            <dd>
              Vertex locations are listed sequentially around the perimeter of the polygon. The last vertex should not repeat the value of the first, as this is implicit.
            </dd>
          </dl>
        </section>
        <section id='paths'>
          <h2>Paths</h2>
          <p>
            A <dfn>WebVMT path</dfn> consists of all the <a>path segments</a> with the same <dfn>path identifier</dfn>.
          </p>
          <p>
            A <dfn>path segment</dfn> consists of a sequence of contiguous <a>WebVMT path fragments</a> that describe the trajectory of an object moving through the mapped space.
          </p>
          <p class='note' title='Non-Contiguous Segments'>
            A <a>WebVMT path</a> may include non-contiguous <a>path segments</a>, but each <a>path segment</a> must contain a sequence of <i>contiguous</i> <a>WebVMT path fragments</a>.
          </p>
          <p>
            A <a>path segment</a> consists of the following components, in the order given:
          </p>
          <ol>
            <li>
              One <a>WebVMT move</a> command;
            </li>
            <li>
              Zero or more <a>WebVMT line</a> commands.
            </li>
          </ol>
          <p>
            A <dfn>WebVMT path fragment</dfn> command consists of the one of the following components:
          </p>
          <ul>
            <li>
              A <a>WebVMT move</a> command;
            </li>
            <li>
              A <a>WebVMT line</a> command.
            </li>
          </ul>
          <p>
            A <dfn>WebVMT move</dfn> command sets the start location of the first <a>WebVMT path fragment</a> in a <a>path segment</a>.
          </p>
          <p>
            A <a>WebVMT move</a> consists of:
          </p>
          <dl>
            <dt>
              A <a>path identifier</a>
            </dt>
            <dd>
              The identifier shared by all the <a>path segments</a> in the <a>WebVMT path</a>.
            </dd>
            <dd>
              By default, the <a>path identifier</a> is set to null.
            </dd>
            <dt>
              A <dfn>fragment start time</dfn>
            </dt>
            <dd>
              The time at which the <a>WebVMT path fragment</a> starts.
            </dd>
            <dd>
              The <a>fragment start time</a> is set to the cue start time.
            </dd>
            <dt>
              A <dfn>fragment start location</dfn>
            </dt>
            <dd>
              The <a>WebVMT location</a> at the <a>fragment start time</a>.
            </dd>
          </dl>
          <p>
            A <dfn>WebVMT line</dfn> command sets the end location of the <a>WebVMT path fragment</a>. The <a>fragment start location</a> is set by the preceding <a>WebVMT path fragment</a> in the <a>WebVMT path</a>.
          </p>
          <p>
            A <a>WebVMT line</a> consists of:
          </p>
          <dl>
            <dt>
              A <a>path identifier</a>
            </dt>
            <dd>
              The identifier shared by all the <a>path segments</a> in the <a>WebVMT path</a>.
            </dd>
            <dd>
              By default, the <a>path identifier</a> is set to null.
            </dd>
            <dt>
              A <dfn>fragment end time</dfn>
            </dt>
            <dd>
              The time at which the <a>WebVMT path fragment</a> ends.
            </dd>
            <dd>
              By default, the <a>fragment end time</a> is set to the cue end time.
            </dd>
            <dd>
              The <a>fragment end time</a> may be defined as an absolute value, or calculated relative to the <a>fragment start time</a> using a duration.
            </dd>
            <dt>
              A <dfn class='export'>fragment end location</dfn>
            </dt>
            <dd>
              The <a>WebVMT location</a> at the <a>fragment end time</a>.
            </dd>
          </dl>
          <p class="note" title="Path Interpolation">
            A <a>WebVMT line</a> is a straight line from the start location to the end location. The location of the moving object can be linearly interpolated between the <a>fragment start time</a> and the <a>fragment end time</a>.
          </p>
        </section>
        <section id='synchronizeddata'>
          <h2>Synchronized Data</h2>
          <p>
            A <dfn>WebVMT synchronized data</dfn> synchronizes a sample from a data source with a <a>WebVMT cue</a>.
          </p>
          <p>
            A <a>WebVMT synchronized data</a> command consists of:
          </p>
          <dl>
            <dt>
              A <dfn>synchronized data object</dfn>
            </dt>
            <dd>
              An arbitrary object representing the raw sample from the data source.
            </dd>
            <dt>
              A <dfn>synchronized data type</dfn>
            </dt>
            <dd>
              An associated data type, e.g. org.geojson.
            </dd>
            <dt>
              Optionally, a <dfn>synchronized data identifier</dfn>
            </dt>
            <dd>
              An identifier shared by all samples from the same data source over time, e.g. for interpolation.
            </dd>
            <dt>
              Optionally, a <dfn>synchronized path identifier</dfn>
            </dt>
            <dd>
              A <a>path identifier</a> associated with the data source, e.g. a moving sensor.
            </dd>
          </dl>
        </section>
        <section id='attributeinterpolation'>
          <h2>Attribute Interpolation</h2>
          <p>
            A <dfn>WebVMT interpolation</dfn> changes an object attribute from a start value to an end value over a time interval.
          </p>
          <p>
            A <a>WebVMT interpolation</a> consists of:
          </p>
          <dl>
            <dt>
              An <dfn>interpolation object</dfn>
            </dt>
            <dd>
              The parent object of the attribute.
            </dd>
            <dt>
              An <dfn>interpolation attribute</dfn>
            </dt>
            <dd>
              The name of the attribute to change.
            </dd>
            <dt>
              An <dfn>interpolation start time</dfn>
            </dt>
            <dd>
              The time at which the interpolation starts.
            </dd>
            <dd>
              By default, the <a>interpolation start time</a> is set to the cue start time.
            </dd>
            <dd>
              The <a>interpolation start time</a> may be defined as an absolute value, or calculated relative to the cue start time using a delay.
            </dd>
            <dt>
              An <dfn>interpolation start value</dfn>
            </dt>
            <dd>
              The initial value of the attribute.
            </dd>
            <dd>
              The <a>interpolation start value</a> is set by the value of the <a>interpolation attribute</a> at the <a>interpolation start time</a>.
            </dd>
            <dt>
              An <dfn>interpolation end time</dfn>
            </dt>
            <dd>
              The time at which the interpolation ends.
            </dd>
            <dd>
              By default, the <a>interpolation end time</a> is set to the cue end time.
            </dd>
            <dd>
              The <a>interpolation end time</a> may be defined as an absolute value, or calculated relative to the interpolation start time using a duration.
            </dd>
            <dt>
              An <dfn>interpolation end value</dfn>
            </dt>
            <dd>
              The final value of the attribute.
            </dd>
          </dl>
          <p>
            A <dfn class='export'>WebVMT interpolation list</dfn> consists of one or more <a>WebVMT interpolations</a> with all interpolation objects set to the preceding <a>WebVMT command</a>.
          </p>
        </section>
      </section>
    </section>
    <section id='syntax'>
      <h2>Syntax</h2>
      <section id='webvmtfilestructure'>
        <h2>WebVMT File Structure</h2>
        <p>
          A <dfn>WebVMT file</dfn> must consist of a <a>WebVMT file body</a> encoded as <a data-cite='RFC3629' data-no-xref=''>UTF-8</a> and labeled with the <a data-cite='HTML51/infrastructure.html#mime-type'>MIME type</a> <code>text/vmt</code>.
        </p>
        <p>
          A <dfn>WebVMT file body</dfn> consists of the following components, in the order given:
          <ol>
            <li>
              An optional U+FEFF BYTE ORDER MARK (BOM) character.
            </li>
            <li>
              The string "<code>WEBVMT</code>" (U+0057 LATIN CAPITAL LETTER W, U+0045 LATIN CAPITAL LETTER E, U+0042 LATIN CAPITAL LETTER B, U+0056 LATIN CAPITAL LETTER V, U+004D LATIN CAPITAL LETTER M, U+0054 LATIN CAPITAL LETTER T).
            </li>
            <li>
              Optionally, either a U+0020 SPACE character or a U+0009 CHARACTER TABULATION (tab) character followed by any number of characters that are not U+000A LINE FEED (LF) or U+000D CARRIAGE RETURN (CR) characters.
            </li>
            <li>
              Two or more <a>WebVMT line terminators</a> to terminate the line with the file magic and separate it from the rest of the body.
            </li>
            <li>
              The following components, in any order, separated from each other by one or more <a>WebVMT line terminators</a>.
            </li>
            <ul>
              <li>
                A <a>WebVMT media definition block</a>.
              </li>
              <li>
                A <a>WebVMT map initialisation block</a>.
              </li>
              <li>
                Zero or more <a>WebVMT style blocks</a> and <a>WebVMT comment blocks</a> separated from each other by one or more <a>WebVMT line terminators</a>.
              </li>
            </ul>
            <li>
              Zero or more <a>WebVMT line terminators</a>.
            </li>
            <li>
              Zero or more <a>WebVMT cue blocks</a> and <a>WebVMT comment blocks</a> separated from each other by one or more <a>WebVMT line terminators</a>.
            </li>
            <li>
              Zero or more <a>WebVMT line terminators</a>.
            </li>
          </ol>
        </p>
        <p>
          A <dfn>WebVMT line terminator</dfn> consists of one of the following:
          <ul>
            <li>
              A U+000D CARRIAGE RETURN U+000A LINE FEED (CRLF) character pair.
            </li>
            <li>
              A single U+000A LINE FEED (LF) character.
            </li>
            <li>
              A single U+000D CARRIAGE RETURN (CR) character.
            </li>
          </ul>
        </p>
        <p>
          A <dfn>WebVMT media definition block</dfn> consists of the following components, in the order given:
          <ol>
            <li>
              The string "<code>MEDIA</code>" (U+004D LATIN CAPITAL LETTER M, U+0045 LATIN CAPITAL LETTER E, U+0044 LATIN CAPITAL LETTER D, U+0049 LATIN CAPITAL LETTER I, U+0041 LATIN CAPITAL LETTER A).
            </li>
            <li>
              Zero or more U+0020 SPACE characters or U+0009 CHARACTER TABULATION (tab) characters.
            </li>
            <li>
              A <a>WebVMT line terminator</a>.
            </li>
            <li>
              A <a>WebVMT media settings list</a>.
            </li>
            <li>
              A <a>WebVMT line terminator</a>.
            </li>
          </ol>
        </p>
        <p>
          A <dfn>WebVMT map initialisation block</dfn> consists of the following components, in the order given:
          <ol>
            <li>
              The string "<code>MAP</code>" (U+004D LATIN CAPITAL LETTER M, U+0041 LATIN CAPITAL LETTER A, U+0050 LATIN CAPITAL LETTER P).
            </li>
            <li>
              Zero or more U+0020 SPACE characters or U+0009 CHARACTER TABULATION (tab) characters.
            </li>
            <li>
              A <a>WebVMT line terminator</a>.
            </li>
            <li>
              A <a>WebVMT map settings list</a>.
            </li>
            <li>
              A <a>WebVMT line terminator</a>.
            </li>
          </ol>
        </p>
        <p class='note' title='Map Initialisation'>
          The <a>WebVMT map initialisation block</a> defines the state of the <a>WebVMT map</a> before any <a>WebVMT cues</a> are active.
        </p>
        <p>
          A <dfn>WebVMT style block</dfn> consists of the following components, in the order given:
          <ol>
            <li>
              The string "<code>STYLE</code>" (U+0053 LATIN CAPITAL LETTER S, U+0054 LATIN CAPITAL LETTER T, U+0059 LATIN CAPITAL LETTER Y, U+004C LATIN CAPITAL LETTER L, U+0045 LATIN CAPITAL LETTER E).
            </li>
            <li>
              Zero or more U+0020 SPACE characters or U+0009 CHARACTER TABULATION (tab) characters.
            </li>
            <li>
              A <a>WebVMT line terminator</a>.
            </li>
            <li>
              Any sequence of zero or more characters other than U+000A LINE FEED (LF) characters and U+000D CARRIAGE RETURN (CR) characters, each optionally separated from the next by a <a>WebVMT line terminator</a>, except that the entire resulting string must not contain the substring "<code>--&gt;</code>" (U+002D HYPHEN-MINUS, U+002D HYPHEN-MINUS, U+003E GREATER-THAN SIGN). The string represents a CSS style sheet; the requirements given in the relevant <a data-cite='CSS22' data-no-xref=''>CSS</a> specifications apply.
            </li>
            <li>
              A <a>WebVMT line terminator</a>.
            </li>
          </ol>
        </p>
        <p>
          A <dfn>WebVMT cue block</dfn> consists of the following components, in the order given:
          <ol>
            <li>
              Optionally, a <a>WebVMT cue identifier</a> followed by a <a>WebVMT line terminator</a>.
            </li>
            <li>
              <a>WebVMT cue timings</a>.
            <li>
              Zero or more U+0020 SPACE characters or U+0009 CHARACTER TABULATION (tab) characters.
            </li>
            <li>
              A <a>WebVMT line terminator</a>.
            </li>
            <li>
              The <dfn>WebVMT cue payload</dfn> consists of a <a>WebVMT metadata text</a>, but must not contain the substring "<code>--&gt;</code>" (U+002D HYPHEN-MINUS, U+002D HYPHEN-MINUS, U+003E GREATER-THAN SIGN).
            </li>
            <li>
              A <a>WebVMT line terminator</a>.
            </li>
          </ol>
        </p>
        <p class='note' title='Cues'>
          A <a>WebVMT cue block</a> corresponds to one piece of time-aligned data in the <a>WebVMT file</a>. The <a>WebVMT cue payload</a> is the data associated with the <a>WebVMT cue</a>.
        </p>
        <p>
          A <dfn>WebVMT cue identifier</dfn> is any sequence of one or more characters not containing the substring "<code>--&gt;</code>" (U+002D HYPHEN-MINUS, U+002D HYPHEN-MINUS, U+003E GREATER-THAN SIGN), nor containing any U+000A LINE FEED (LF) characters or U+000D CARRIAGE RETURN (CR) characters.
        </p>
        <p>
          A <a>WebVMT cue identifier</a> must be unique amongst all the <a>WebVMT cue identifiers</a> of all <a>WebVMT cues</a> of a <a>WebVMT file</a>.
        </p>
        <p class='note' title='Cue References'>
          A <a>WebVMT cue identifier</a> can be used to reference a specific cue, for example from script or CSS.
        </p>
        <p>
          The <dfn>WebVMT cue timings</dfn> part of a <a>WebVMT cue block</a> consists of the following components, in the order given:
        </p>
        <ol>
          <li>
            A <a>WebVMT timestamp</a> representing the start time offset of the cue. The time represented by this <a>WebVMT timestamp</a> must be greater than or equal to the start time offsets of all previous cues in the file.
          </li>
          <li>
            One or more U+0020 SPACE characters or U+0009 CHARACTER TABULATION (tab) characters.
          </li>
          <li>
            The string "<code>--&gt;</code>" (U+002D HYPHEN-MINUS, U+002D HYPHEN-MINUS, U+003E GREATER-THAN SIGN).
          </li>
          <li>
            One or more U+0020 SPACE characters or U+0009 CHARACTER TABULATION (tab) characters.
          </li>
          <li>
            Optionally, a <a>WebVMT timestamp</a> representing the end time offset of the cue. The time represented by this <a>WebVMT timestamp</a> must be greater than or equal to the start time offset of the cue.
          </li>
        </ol>
        <p class='note' title='Cue Timings'>
          The <a>WebVMT cue timings</a> give the start and end offsets of the <a>WebVMT cue block</a>. Different cues can overlap. Cues are always listed ordered by their start time.
        </p>
        <p>
          A <dfn>WebVMT timestamp</dfn> consists of the following components, in the order given:
          <ol>
            <li>
              Optionally (required if <i>hours</i> is non-zero):
              <ol>
                <li>
                  Two or more <a data-cite='HTML51/infrastructure.html#ascii-digits'>ASCII digits</a>, representing the <i>hours</i> as a base ten integer.
                </li>
                <li>
                  A U+003A COLON character (:).
                </li>
              </ol>
            </li>
            <li>
              Two <a data-cite='HTML51/infrastructure.html#ascii-digits'>ASCII digits</a>, representing the <i>minutes</i> as a base ten integer in the range 0 ≤ <i>minutes</i> ≤ 59.
            </li>
            <li>
              A U+003A COLON character (:).
            </li>
            <li>
              Two <a data-cite='HTML51/infrastructure.html#ascii-digits'>ASCII digits</a>, representing the <i>seconds</i> as a base ten integer in the range 0 ≤ <i>seconds</i> ≤ 59.
            </li>
            <li>
              A U+002E FULL STOP character (.).
            </li>
            <li>
              Three <a data-cite='HTML51/infrastructure.html#ascii-digits'>ASCII digits</a>, representing the thousandths of a second <i>seconds-frac</i> as a base ten integer.
            </li>
          </ol>
        </p>
        <p class='note' title='Timestamp Interpretation'>
          A <a>WebVMT timestamp</a> is always interpreted relative to the <a data-cite='HTML51/semantics-embedded-content.html#current-position'>current playback position</a> of the media data with which the <a>WebVMT file</a> is to be synchronized.
        </p>
        <p>
          A <dfn>WebVMT comment block</dfn> consists of the following components, in the order given:
          <ol>
            <li>
              The string "<code>NOTE</code>" (U+004E LATIN CAPITAL LETTER N, U+004F LATIN CAPITAL LETTER O, U+0054 LATIN CAPITAL LETTER T, U+0045 LATIN CAPITAL LETTER E).
            </li>
            <li>
              Optionally, the following components, in the order given:
              <ol>
                <li>
                  Either:
                  <ul>
                    <li>
                      A U+0020 SPACE character or U+0009 CHARACTER TABULATION (tab) character.
                    </li>
                    <li>
                      A <a>WebVMT line terminator</a>.
                    </li>
                  </ul>
                </li>
                <li>
                  Any sequence of zero or more characters other than U+000A LINE FEED (LF) characters and U+000D CARRIAGE RETURN (CR) characters, each optionally separated from the next by a <a>WebVMT line terminator</a>, except that the entire resulting string must not contain the substring "<code>--&gt;</code>" (U+002D HYPHEN-MINUS, U+002D HYPHEN-MINUS, U+003E GREATER-THAN SIGN).
                </li>
              </ol>
            </li>
            <li>
              A <a>WebVMT line terminator</a>.
            </li>
          </ol>
        </p>
        <p class='note' title='Comment Parsing'>
          A <a>WebVMT comment block</a> is ignored by the parser.
        </p>
      </section>
      <section>
        <h2>WebVMT Cue Payload</h2>
        <p>
          <dfn>WebVMT metadata text</dfn> consists of any sequence of zero or more characters other than U+000A LINE FEED (LF) characters and U+000D CARRIAGE RETURN (CR) characters, each optionally separated from the next by a <a>WebVMT line terminator</a>. (In other words, any text that does not have two consecutive <a>WebVMT line terminators</a> and does not start or end with a <a>WebVMT line terminator</a>.)
        </p>
        <p>
          The string represents a <a>WebVMT command list</a>.
        </p>
        <p>
          <a>WebVMT metadata text</a> cues are only useful for scripted applications (e.g. using the <code>metadata</code> text track <a data-cite='HTML51/semantics-embedded-content.html#kind-of-track'>kind</a> in a HTML <a data-cite='HTML51/semantics-embedded-content.html#text-tracks'>text track</a>).
        </p>
      </section>
      <section>
        <h2>WebVMT Media Settings</h2>
        <p>
          The <dfn>WebVMT media settings list</dfn> consists of zero or more of the following components, in any order, separated from each other by one or more U+0020 SPACE characters, U+0009 CHARACTER TABULATION (tab) characters, or </a>WebVMT line terminators</a>, except that the string must not contain two consecutive <a>WebVMT line terminators</a>. Each component must not be included more than once per <a>WebVMT media settings list</a> string.
        </p>
        <ul>
          <li>
            A <a>WebVMT media url setting</a>.
          </li>
          <li>
            A <a>WebVMT media MIME type setting</a>.
          </li>
          <li>
            A <a>WebVMT media start time setting</a>.
          </li>
          <li>
            A <a>WebVMT media path setting</a>.
          </li>
        </ul>
        <p>
          A <dfn>WebVMT media url setting</dfn> consists of the following components, in the order given:
        </p>
        <ol>
          <li>
            The string "<code>url</code>".
          </li>
          <li>
            A U+003A COLON character (:).
          </li>
          <li>
            A <a data-cite='HTML51/infrastructure.html#valid-url'>valid URL</a>.
          </li>
        </ol>
        <p class='note' title='URL Resolution'>
          For the purpose of resolving a <a data-cite='RFC3986' data-no-xref=''>URL</a> in the <code>MEDIA</code> block of a WebVMT file, or any URLs in resources referenced from <code>MEDIA</code> blocks of a WebVMT file, if the URL’s scheme is not "<code>data</code>", then the user agent must act as if the URL failed to resolve. If the <code>url</code> value does not match the <code>tileurl</code> attribute of the HTML <code>&lt;track&gt;</code> element, then the <code>tileurl</code> value takes precedence.
        </p>
        <p>
          A <dfn>WebVMT media MIME type setting</dfn> consists of the following components, in the order given:
        </p>
        <ol>
          <li>
            The string "<code>mimetype</code>".
          </li>
          <li>
            A U+003A COLON character (:).
          </li>
          <li>
            A <a data-cite='HTML51/infrastructure.html#valid-mime-type'>valid MIME type</a>.
          </li>
        </ol>
        <p>
          A <dfn>WebVMT media start time setting</dfn> consists of the following components, in the order given:
        </p>
        <ol>
          <li>
            The string "<code>starttime</code>".
          </li>
          <li>
            A U+003A COLON character (:).
          </li>
          <li>
            A <a data-cite='HTML51/infrastructure.html#valid-global-date-and-time-string'>valid global date and time string</a>.
          </li>
        </ol>
        <p>
          A <dfn>WebVMT media path setting</dfn> consists of the following components, in the order given:
        </p>
        <ol>
          <li>
            The string "<code>path</code>".
          </li>
          <li>
            A U+003A COLON character (:).
          </li>
          <li>
            A <a>WebVMT path identifier</a>.
          </li>
        </ol>
      </section>
      <section>
        <h2>WebVMT Map Settings</h2>
        <p>
          The <dfn>WebVMT map settings list</dfn> consists of the following components, in any order, separated from each other by one or more U+0020 SPACE characters, U+0009 CHARACTER TABULATION (tab) characters, or <a>WebVMT line terminators</a>, except that the string must not contain two consecutive <a>WebVMT line terminators</a>. Each component must be included once per <a>WebVMT map settings list</a> string.
        </p>
        <ul>
          <li>
            A <a>WebVMT map center latitude setting</a>.
          </li>
          <li>
            A <a>WebVMT map center longitude setting</a>.
          </li>
          <li>
            Optionally, a <a>WebVMT map center altitude setting</a>.
          </li>
          <li>
            A <a>WebVMT map zoom setting</a>.
          </li>
        </ul>
        <p class='note' title='Initial Map State'>
          The <a>WebVMT map settings list</a> defines the <a>WebVMT map</a> state before the first cue.
        </p>
        <p>
          A <dfn>WebVMT map center latitude setting</dfn> consists of a <a>WebVMT latitude setting</a>.
        </p>
        <p>
          A <dfn>WebVMT map center longitude setting</dfn> consists of a <a>WebVMT longitude setting</a>.
        </p>
        <p>
          A <dfn>WebVMT map center altitude setting</dfn> consists of a <a>WebVMT altitude setting</a>.
        </p>
        <p>
          A <dfn>WebVMT latitude setting</dfn> consists of the following components, in the order given:
          <ol>
            <li>
              The string "<code>lat</code>".
            </li>
            <li>
              A U+003A COLON character (:).
            </li>
            <li>
              A <a>WebVMT latitude</a>.
            </li>
          </ol>
        </p>
        <p>
          A <dfn>WebVMT latitude</dfn> consists of the following components, in the order given:
          <ol>
            <li>
              Optionally, a U+002D HYPHEN-MINUS character (-).
            </li>
            <li>
              One or more <a data-cite='HTML51/infrastructure.html#ascii-digits'>ASCII digits</a>.
            </li>
            <li>
              Optionally:
              <ol>
                <li>
                  A U+002E DOT character (.).
                </li>
                <li>
                  One or more <a data-cite='HTML51/infrastructure.html#ascii-digits'>ASCII digits</a>.
                </li>
              </ol>
            </li>
          </ol>
        </p>
        <p class='note' title='Latitude Range'>
          When interpreted as a number, a <a>WebVMT latitude</a> must be in the range -90..+90.
        </p>
        <p>
          A <dfn>WebVMT longitude setting</dfn> consists of the following components, in the order given:
          <ol>
            <li>
              The string "<code>lng</code>".
            </li>
            <li>
              A U+003A COLON character (:).
            </li>
            <li>
              A <a>WebVMT longitude</a>.
            </li>
          </ol>
        </p>
        <p>
          A <dfn>WebVMT longitude</dfn> consists of the following components, in the order given:
          <ol>
            <li>
              Optionally, a U+002D HYPHEN-MINUS character (-).
            </li>
            <li>
              One or more <a data-cite='HTML51/infrastructure.html#ascii-digits'>ASCII digits</a>.
            </li>
            <li>
              Optionally:
              <ol>
                <li>
                  A U+002E DOT character (.).
                </li>
                <li>
                  One or more <a data-cite='HTML51/infrastructure.html#ascii-digits'>ASCII digits</a>.
                </li>
              </ol>
            </li>
          </ol>
        </p>
        <p class='note' title='Longitude Range'>
          When interpreted as a number, a <a>WebVMT longitude</a> must be in the range -180..+180.
        </p>
        <p>
          A <dfn>WebVMT altitude setting</dfn> consists of the following components, in the order given:
          <ol>
            <li>
              The string "<code>alt</code>".
            </li>
            <li>
              A U+003A COLON character (:).
            </li>
            <li>
              A <a>WebVMT altitude</a>.
            </li>
          </ol>
        </p>
        <p>
          A <dfn>WebVMT altitude</dfn> consists of the following components, in the order given:
          <ol>
            <li>
              Optionally, a U+002D HYPHEN-MINUS character (-).
            </li>
            <li>
              One or more <a data-cite='HTML51/infrastructure.html#ascii-digits'>ASCII digits</a>.
            </li>
            <li>
              Optionally:
              <ol>
                <li>
                  A U+002E DOT character (.).
                </li>
                <li>
                  One or more <a data-cite='HTML51/infrastructure.html#ascii-digits'>ASCII digits</a>.
                </li>
              </ol>
            </li>
          </ol>
        </p>
        <p class='note' title='Altitude Zero'>
          When interpreted as a number, a <a>WebVMT altitude</a> represents the height in meters above the WGS84 ellipsoid. Care should be taken not to confuse this with the height above mean sea level.
        </p>
        <p>
          A <dfn>WebVMT map zoom setting</dfn> consists of the following components, in the order given:
          <ol>
            <li>
              The string "<code>rad</code>".
            </li>
            <li>
              A U+003A COLON character (:).
            </li>
            <li>
              One or more <a data-cite='HTML51/infrastructure.html#ascii-digits'>ASCII digits</a>.
            </li>
            <li>
              Optionally:
              <ol>
                <li>
                  A U+002E DOT character (.).
                </li>
                <li>
                  One or more <a data-cite='HTML51/infrastructure.html#ascii-digits'>ASCII digits</a>.
                </li>
              </ol>
            </li>
          </ol>
        </p>
        <p class='note' title='Zoom Radius'>
          When interpreted as a number, the <a>WebVMT map zoom setting</a> represents the <a>map zoom radius</a>.
        </p>
      </section>
      <section>
        <h2>WebVMT Commands</h2>
        <p>
          A <dfn>WebVMT command list</dfn> consists of one or more of the following components in any order, separated from each other by a <a>WebVMT line terminator</a>:
          <ul>
            <li>
              A <a>WebVMT map control command</a>.
            </li>
            <li>
              A <a>WebVMT zone annotation command</a>.
            </li>
            <li>
              A <a>WebVMT path annotation command</a>.
            </li>
            <li>
              A <a>WebVMT synchronized data command</a>.
            </li>
          </ul>
        </p>
        <section>
          <h2>WebVMT Map Commands</h2>
          <p>
            A <dfn>WebVMT map control command</dfn> consists of one of the following components:
            <ul>
              <li>
                A <a>WebVMT pan command</a>.
              </li>
              <li>
                A <a>WebVMT zoom command</a>.
              </li>
            </ul>
          </p>
          <p>
            A <dfn>WebVMT pan command</dfn> consists of a <a data-cite='ECMA-404' data-no-xref=''>JSON text</a> representing the following <a data-cite='ECMA-404' data-no-xref=''>JSON object</a>:
            <ul>
              <li>
                The <a data-cite='ECMA-404' data-no-xref=''>JSON string</a> "<code>panto</code>".
              </li>
              <li>
                A <a data-cite='ECMA-404' data-no-xref=''>JSON value</a> consisting of a <a>WebVMT pan parameter list</a>.
              </li>
            </ul>
          </p>
          <p>
            A <dfn>WebVMT pan parameter list</dfn> is a <a data-cite='ECMA-404' data-no-xref=''>JSON object</a> representing the following components in any order:
            <ul>
              <li>
                A <a>WebVMT pan latitude attribute</a>.
              </li>
              <li>
                A <a>WebVMT pan longitude attribute</a>.
              </li>
              <li>
                Optionally, a <a>WebVMT pan altitude attribute</a>.
              </li>
              <li>
                Optionally, one of the following components:
                <ul>
                  <li>
                    A <a>WebVMT pan end time attribute</a>.
                  </li>
                  <li>
                    A <a>WebVMT pan duration attribute</a>.
                  </li>
                </ul>
              </li>
            </ul>
          </p>
          <p>
            A <dfn >WebVMT pan latitude attribute</dfn> consists of a <a>WebVMT latitude attribute</a>.
          </p>
          <p>
            A <dfn >WebVMT pan longitude attribute</dfn> consists of a <a>WebVMT longitude attribute</a>.
          </p>
          <p>
            A <dfn >WebVMT pan altitude attribute</dfn> consists of a <a>WebVMT altitude attribute</a>.
          </p>
          <p>
            A <dfn>WebVMT pan end time attribute</dfn> consists of a <a>WebVMT end time attribute</a>.
          </p>
          <p>
            A <dfn>WebVMT pan duration attribute</dfn> consists of a <a>WebVMT duration attribute</a>.
          </p>
          <p>
            A <dfn>WebVMT zoom command</dfn> consists of a <a data-cite='ECMA-404' data-no-xref=''>JSON text</a> representing the following <a data-cite='ECMA-404' data-no-xref=''>JSON object</a>:
            <ul>
              <li>
                The <a data-cite='ECMA-404' data-no-xref=''>JSON string</a> "<code>zoom</code>".
              </li>
              <li>
                A <a data-cite='ECMA-404' data-no-xref=''>JSON value</a> consisting of a <a>WebVMT zoom parameter list</a>.
              </li>
            </ul>
          </p>
          <p>
            A <dfn>WebVMT zoom parameter list</dfn> is a <a data-cite='ECMA-404' data-no-xref=''>JSON object</a> representing the following component:
            <ul>
              <li>
                A <a>WebVMT zoom radius attribute</a>.
              </li>
            </ul>
          </p>
          <p>
            A <dfn>WebVMT zoom radius attribute</dfn> consists of a <a>WebVMT radius attribute</a>.
          </p>
          <p class='note' title='Zoom Radius'>
            When interpreted as a number, the <a>WebVMT zoom radius attribute</a> value represents the <a>map zoom radius</a>.
          </p>
          <p>
            A <dfn>WebVMT radius attribute</dfn> consists of a <a data-cite='ECMA-404' data-no-xref=''>JSON text</a> consisting of the following components in the order given:
          </p>
          <p>
            <ol>
              <li>
                The <a data-cite='ECMA-404' data-no-xref=''>JSON string</a> "<code>rad</code>".
              </li>
              <li>
                A U+003A COLON character (:).
              </li>
              <li>
                A <a data-cite='ECMA-404' data-no-xref=''>JSON value</a> consisting of a <a data-cite='ECMA-404' data-no-xref=''>JSON number</a> greater than zero.
              </li>
            </ol>
          </p>
        </section>
        <section>
          <h2>WebVMT Zone Commands</h2>
          <p>
            A <dfn>WebVMT zone annotation command</dfn> consists of one of the following components:
            <ul>
              <li>
                A <a>WebVMT circle command</a>.
              </li>
              <li>
                A <a>WebVMT polygon command</a>.
              </li>
            </ul>
          </p>
          <p>
            A <dfn>WebVMT circle command</dfn> consists of a <a data-cite='ECMA-404' data-no-xref=''>JSON text</a> representing the following <a data-cite='ECMA-404' data-no-xref=''>JSON object</a>:
            <ul>
              <li>
                The <a data-cite='ECMA-404' data-no-xref=''>JSON string</a> "<code>circle</code>".
              </li>
              <li>
                A <a data-cite='ECMA-404' data-no-xref=''>JSON value</a> consisting of a <a>WebVMT circle parameter list</a>.
              </li>
            </ul>
          </p>
          <p>
            A <dfn>WebVMT circle parameter list</dfn> consists of a <a data-cite='ECMA-404' data-no-xref=''>JSON object</a> representing the following components in any order:
            <ul>
              <li>
                A <a>WebVMT circle center latitude attribute</a>.
              </li>
              <li>
                A <a>WebVMT circle center longitude attribute</a>.
              </li>
              <li>
                Optionally, a <a>WebVMT circle center altitude attribute</a>.
              </li>
              <li>
                A <a>WebVMT circle radius attribute</a>.
              </li>
            </ul>
          </p>
          <p>
            A <dfn>WebVMT circle center latitude attribute</dfn> consists of a <a>WebVMT latitude attribute</a>.
          </p>
          <p>
            A <dfn>WebVMT circle center longitude attribute</dfn> consists of a <a>WebVMT longitude attribute</a>.
          </p>
          <p>
            A <dfn>WebVMT circle center altitude attribute</dfn> consists of a <a>WebVMT altitude attribute</a>.
          </p>
          <p>
            A <dfn>WebVMT circle radius attribute</dfn> consists of a <a>WebVMT radius attribute</a>.
          </p>
          <p>
            A <dfn>WebVMT polygon command</dfn> consists of a <a data-cite='ECMA-404' data-no-xref=''>JSON text</a> representing the following <a data-cite='ECMA-404' data-no-xref=''>JSON object</a>:
          </p>
          <p>
            <ul>
              <li>
                The <a data-cite='ECMA-404' data-no-xref=''>JSON string</a> "<code>polygon</code>".
              </li>
              <li>
                A <a data-cite='ECMA-404' data-no-xref=''>JSON value</a> consisting of a <a>WebVMT polygon parameter list</a>.
              </li>
            </ul>
          </p>
          <p>
            A <dfn>WebVMT polygon parameter list</dfn> consists of the following <a data-cite='ECMA-404' data-no-xref=''>JSON object</a>:
            <ul>
              <li>
                A <a>WebVMT zone perimeter list</a>.
              </li>
            </ul>
          </p>
          <p>
            A <dfn>WebVMT zone perimeter list</dfn> consists of the following <a data-cite='ECMA-404' data-no-xref=''>JSON object</a>:
            <ul>
              <li>
                The <a data-cite='ECMA-404' data-no-xref=''>JSON string</a> "<code>perim</code>".
              </li>
              <li>
                A <a data-cite='ECMA-404' data-no-xref=''>JSON value</a> consisting of a <a>WebVMT vertices list</a>.
              </li>
            </ul>
          </p>
          <p>
            A <dfn>WebVMT vertices list</dfn> consists of a <a data-cite='ECMA-404' data-no-xref=''>JSON array</a> of three or more <a data-cite='ECMA-404' data-no-xref=''>JSON objects</a> each representing a <a>WebVMT location attribute list</a>.
          </p>
          <p>
            A <dfn>WebVMT location attribute list</dfn> consists of a <a data-cite='ECMA-404' data-no-xref=''>JSON text</a> representing a list of the following <a data-cite='ECMA-404' data-no-xref=''>JSON values</a> in any order, separated from each other by a U+002C COMMA character (,):
            <ul>
              <li>
                A <a>WebVMT latitude attribute</a>.
              </li>
              <li>
                A <a>WebVMT longitude attribute</a>.
              </li>
              <li>
                Optionally, a <a>WebVMT altitude attribute</a>.
              </li>
            </ul>
          </p>
          <p>
            A <dfn>WebVMT latitude attribute</dfn> consists of a <a data-cite='ECMA-404' data-no-xref=''>JSON text</a> consisting of the following components in the order given:
            <ol>
              <li>
                The <a data-cite='ECMA-404' data-no-xref=''>JSON string</a> "<code>lat</code>".
              </li>
              <li>
                A U+003A COLON character (:).
              </li>
              <li>
                A <a data-cite='ECMA-404' data-no-xref=''>JSON value</a> consisting of a <a data-cite='ECMA-404' data-no-xref=''>JSON number</a>.
              </li>
            </ol>
          </p>
          <p class='note' title='Latitude Range'>
            When interpreted as a number, a <a>WebVMT latitude attribute</a> must be in the range -90..+90.
          </p>
          <p>
            A <dfn>WebVMT longitude attribute</dfn> consists of a <a data-cite='ECMA-404' data-no-xref=''>JSON text</a> consisting of the following components in the order given:
            <ol>
              <li>
                The <a data-cite='ECMA-404' data-no-xref=''>JSON string</a> "<code>lng</code>".
              </li>
              <li>
                A U+003A COLON character (:).
              </li>
              <li>
                A <a data-cite='ECMA-404' data-no-xref=''>JSON value</a> consisting of a <a data-cite='ECMA-404' data-no-xref=''>JSON number</a>.
              </li>
            </ol>
          </p>
          <p class='note' title='Longitude Range'>
            When interpreted as a number, a <a>WebVMT longitude attribute</a> must be in the range -180..+180.
          </p>
          <p>
            A <dfn>WebVMT altitude attribute</dfn> consists of a <a data-cite='ECMA-404' data-no-xref=''>JSON text</a> consisting of the following components in the order given:
            <ol>
              <li>
                The <a data-cite='ECMA-404' data-no-xref=''>JSON string</a> "<code>alt</code>".
              </li>
              <li>
                A U+003A COLON character (:).
              </li>
              <li>
                A <a data-cite='ECMA-404' data-no-xref=''>JSON value</a> consisting of a <a data-cite='ECMA-404' data-no-xref=''>JSON number</a>.
              </li>
            </ol>
          </p>
          <p class='note' title='Altitude Zero'>
            When interpreted as a number, a <a>WebVMT altitude</a> represents the height in meters above the WGS84 ellipsoid. Care should be taken not to confuse this with the height above mean sea level.
          </p>
        </section>
        <section>
          <h2>WebVMT Path Commands</h2>
          <p>
            A <dfn>WebVMT path annotation command</dfn> consists of one of the following components:
            <ul>
              <li>
                A <a>WebVMT move command</a>.
              </li>
              <li>
                A <a>WebVMT line command</a>.
              </li>
            </ul>
          </p>
          <p>
            A <dfn>WebVMT move command</dfn> consists of a <a data-cite='ECMA-404' data-no-xref=''>JSON text</a> representing the following <a data-cite='ECMA-404' data-no-xref=''>JSON object</a>:
            <ul>
              <li>
                The <a data-cite='ECMA-404' data-no-xref=''>JSON string</a> "<code>moveto</code>".
              </li>
              <li>
                A <a data-cite='ECMA-404' data-no-xref=''>JSON value</a> consisting of a <a>WebVMT move parameter list</a>.
              </li>
            </ul>
          </p>
          <p>
            A <dfn>WebVMT move parameter list</dfn> is a <a data-cite='ECMA-404' data-no-xref=''>JSON object</a> representing the following components in any order:
            <ul>
              <li>
                A <a>WebVMT fragment start latitude attribute</a>.
              </li>
              <li>
                A <a>WebVMT fragment start longitude attribute</a>.
              </li>
              <li>
                Optionally, a <a>WebVMT fragment start altitude attribute</a>.
              </li>
              <li>
                Optionally, a <a>WebVMT path attribute</a>.
              </li>
            </ul>
          </p>
          <p>
            A <dfn>WebVMT fragment start latitude attribute</dfn> consists of a <a>WebVMT latitude attribute</a>.
          </p>
          <p>
            A <dfn>WebVMT fragment start longitude attribute</dfn> consists of a <a>WebVMT longitude attribute</a>.
          </p>
          <p>
            A <dfn>WebVMT fragment start altitude attribute</dfn> consists of a <a>WebVMT altitude attribute</a>.
          </p>
          <p>
            A <dfn>WebVMT path attribute</dfn> consists of a <a data-cite='ECMA-404' data-no-xref=''>JSON text</a> consisting of the following components in the order given:
            <ol>
              <li>
                The <a data-cite='ECMA-404' data-no-xref=''>JSON string</a> "<code>path</code>".
              </li>
              <li>
                A U+003A COLON character (:).
              </li>
              <li>
                A <a data-cite='ECMA-404' data-no-xref=''>JSON value</a> consisting of a <a data-cite='ECMA-404' data-no-xref=''>JSON string</a> representing a <a>WebVMT path identifier</a>.
              </li>
            </ol>
          </p>
          <p>
            A <dfn>WebVMT path identifier</dfn> is any sequence of one or more characters not containing the substring "--&gt;" (U+002D HYPHEN-MINUS, U+002D HYPHEN-MINUS, U+003E GREATER-THAN SIGN), nor containing any U+000A LINE FEED (LF) characters or U+000D CARRIAGE RETURN (CR) characters.
          </p>
          <p class='note' title='Path Identification'>
            A <a>WebVMT path identifier</a> is a string which uniquely identifies a moving object in the <a>WebVMT file</a>, for example a camera.
          </p>
          <p>
            A <dfn>WebVMT line command</dfn> consists of a <a data-cite='ECMA-404' data-no-xref=''>JSON text</a> representing the following <a data-cite='ECMA-404' data-no-xref=''>JSON object</a>:
            <ul>
              <li>
                The <a data-cite='ECMA-404' data-no-xref=''>JSON string</a> "<code>lineto</code>".
              </li>
              <li>
                A <a data-cite='ECMA-404' data-no-xref=''>JSON value</a> consisting of a <a>WebVMT line parameter list</a>.
              </li>
            </ul>
          </p>
          <p>
            A <dfn>WebVMT line parameter list</dfn> consists of a <a data-cite='ECMA-404' data-no-xref=''>JSON object</a> representing the following components in any order:
            <ul>
              <li>
                A <a>WebVMT fragment end latitude attribute</a>.
              </li>
              <li>
                A <a>WebVMT fragment end longitude attribute</a>.
              </li>
              <li>
                Optionally, a <a>WebVMT fragment end altitude attribute</a>.
              </li>
              <li>
                Optionally, a <a>WebVMT path attribute</a>.
              </li>
              <li>
                Optionally, one of the following components:
                <ul>
                  <li>
                    A <a>WebVMT fragment end time attribute</a>.
                  </li>
                  <li>
                    A <a>WebVMT fragment duration attribute</a>.
                  </li>
                </ul>
              </li>
            </ul>
          </p>
          <p>
            A <dfn>WebVMT fragment end latitude attribute</dfn> consists of a <a>WebVMT latitude attribute</a>.
          </p>
          <p>
            A <dfn>WebVMT fragment end longitude attribute</dfn> consists of a <a>WebVMT longitude attribute</a>.
          </p>
          <p>
            A <dfn>WebVMT fragment end altitude attribute</dfn> consists of a <a>WebVMT altitude attribute</a>.
          </p>
          <p>
            A <dfn>WebVMT fragment end time attribute</dfn> consisting of a <a>WebVMT end time attribute</a>.
          </p>
          <p>
            A <dfn>WebVMT fragment duration attribute</dfn> consisting of a <a>WebVMT duration attribute</a>.
          </p>
        </section>
        <section>
          <h2>WebVMT Synchronization Command</h2>
          <p>
            A <dfn>WebVMT synchronized data command</dfn> consists of a <a data-cite='ECMA-404' data-no-xref=''>JSON text</a> representing the following <a data-cite='ECMA-404' data-no-xref=''>JSON object</a>:
            <ul>
              <li>
                The <a data-cite='ECMA-404' data-no-xref=''>JSON string</a> "<code>sync</code>".
              </li>
              <li>
                A <a data-cite='ECMA-404' data-no-xref=''>JSON value</a> consisting of a <a>WebVMT synchronized parameter list</a>.
              </li>
            </ul>
          </p>
          <p>
            A <dfn>WebVMT synchronized parameter list</dfn> consists of a <a data-cite='ECMA-404' data-no-xref=''>JSON object</a> representing the following components in any order:
            <ul>
              <li>
                A <a>WebVMT synchronized type attribute</a>.
              </li>
              <li>
                A <a>WebVMT synchronized data attribute</a>.
              </li>
              <li>
                Optionally, a <a>WebVMT synchronized identifier attribute</a>.
              </li>
              <li>
                Optionally, a <a>WebVMT synchronized path attribute</a>.
              </li>
            </ul>
          </p>
          <p>
            A <dfn>WebVMT synchronized type attribute</dfn> consists of a <a data-cite='ECMA-404' data-no-xref=''>JSON text</a> consisting of the following components in the order given:
            <ol>
              <li>
                The <a data-cite='ECMA-404' data-no-xref=''>JSON string</a> "<code>type</code>".
              </li>
              <li>
                A U+003A COLON character (:).
              </li>
              <li>
                A <a data-cite='ECMA-404' data-no-xref=''>JSON string</a> representing a <a>synchronized data type</a>.
              </li>
            </ol>
          </p>
          <p>
            A <dfn>WebVMT synchronized data attribute</dfn> consists of a <a data-cite='ECMA-404' data-no-xref=''>JSON text</a> consisting of the following components in the order given:
            <ol>
              <li>
                The <a data-cite='ECMA-404' data-no-xref=''>JSON string</a> "<code>data</code>".
              </li>
              <li>
                A U+003A COLON character (:).
              </li>
              <li>
                A <a data-cite='ECMA-404' data-no-xref=''>JSON object</a> representing a <a>synchronized data object</a>.
              </li>
            </ol>
          </p>
          <p>
            A <dfn>WebVMT synchronized identifier attribute</dfn> consists of a <a data-cite='ECMA-404' data-no-xref=''>JSON text</a> consisting of the following components in the order given:
            <ol>
              <li>
                The <a data-cite='ECMA-404' data-no-xref=''>JSON string</a> "<code>id</code>".
              </li>
              <li>
                A U+003A COLON character (:).
              </li>
              <li>
                A <a data-cite='ECMA-404' data-no-xref=''>JSON string</a> representing a <a>synchronized data identifier</a>.
              </li>
            </ol>
          </p>
          <p>
            A <dfn>WebVMT synchronized path attribute</dfn> consists of a <a>WebVMT path attribute</a> representing a <a>synchronized path identifier</a>.
          </p>
        </section>
        <section>
          <h2>WebVMT Interpolation Subcommand</h2>
          <p>
            A <dfn>WebVMT interpolation subcommand</dfn> consists of a <a data-cite='ECMA-404' data-no-xref=''>JSON text</a> representing the following <a data-cite='ECMA-404' data-no-xref=''>JSON object</a>:
            <ul>
              <li>
                The <a data-cite='ECMA-404' data-no-xref=''>JSON string</a> "<code>interp</code>".
              </li>
              <li>
                A <a data-cite='ECMA-404' data-no-xref=''>JSON value</a> consisting of a <a>WebVMT interpolation parameter list</a>.
              </li>
            </ul>
          </p>
          <p class='note' title='Parent Command'>
            The <a>WebVMT interpolation subcommand</a> refers to the attributes of its parent command. The parent command is the <a>interpolation object</a>.
          </p>
          <p>
            A <dfn>WebVMT interpolation parameter list</dfn> consists of a <a data-cite='ECMA-404' data-no-xref=''>JSON object</a> consisting of the following components in any order:
            <ul>
              <li>
                A <a>WebVMT interpolation target attribute</a>.
              </li>
              <li>
                Optionally, one of the following components:
                <ul>
                  <li>
                    A <a>WebVMT end time attribute</a>.
                  </li>
                  <li>
                    A <a>WebVMT duration attribute</a>.
                  </li>
                </ul>
              </li>
            </ul>
          </p>
          <p>
            A <dfn>WebVMT interpolation target attribute</dfn> consists of a <a data-cite='ECMA-404' data-no-xref=''>JSON text</a> consisting of the following components in the order given:
            <ol>
              <li>
                The <a data-cite='ECMA-404' data-no-xref=''>JSON string</a> "<code>to</code>".
              </li>
              <li>
                A U+003A COLON character (:).
              </li>
              <li>
                A <a data-cite='ECMA-404' data-no-xref=''>JSON object</a> representing a <a>WebVMT interpolation target parameter list</a>.
              </li>
            </ol>
          </p>
          <p>
            A <dfn>WebVMT interpolation target parameter list</dfn> consists of a <a data-cite='ECMA-404' data-no-xref=''>JSON object</a> representing the <a>interpolation attributes</a> set to <a>interpolation end values</a>.
          </p>
          <p class='note' title='Interpolation Target Omissions'>
            Attributes of the <a>interpolation object</a> omitted from a <a>WebVMT interpolation target parameter list</a> are not affected by that subcommand.
          </p>
          <p>
            A <dfn>WebVMT end time attribute</dfn> consists of a <a data-cite='ECMA-404' data-no-xref=''>JSON text</a> consisting of the following components in the order given:
            <ol>
              <li>
                The <a data-cite='ECMA-404' data-no-xref=''>JSON string</a> "<code>end</code>".
              </li>
              <li>
                A U+003A COLON character (:).
              </li>
              <li>
                A <a data-cite='ECMA-404' data-no-xref=''>JSON string</a> representing a <a>WebVMT timestamp</a>.
              </li>
            </ol>
          </p>
          <p>
            By default, the <a>WebVMT end time attribute</a> is set to the <a>WebVMT cue</a> end time value.
          </p>
          <p class='note' title='End Time'>
            A <a>WebVMT end time attribute</a> represents the time at which a process ends.
          </p>
          <p>
            A <dfn>WebVMT duration attribute</dfn> consists of a <a data-cite='ECMA-404' data-no-xref=''>JSON text</a> consisting of the following components in the order given:
            <ol>
              <li>
                The <a data-cite='ECMA-404' data-no-xref=''>JSON string</a> "<code>dur</code>".
              </li>
              <li>
                A U+003A COLON character (:).
              </li>
              <li>
                A <a data-cite='ECMA-404' data-no-xref=''>JSON string</a> representing a <a>WebVMT timespan</a>.
              </li>
            </ol>
          </p>
          <p class='note' title='Duration'>
            A <a>WebVMT duration attribute</a> represents the time interval for which a process lasts and supersedes the default value of the <a>WebVMT end time attribute</a>.
          </p>
          <p>
            A <dfn>WebVMT timespan</dfn> is the positive time offset between two <a>WebVMT timestamps</a> and is represented in <a>WebVMT timestamp</a> format.
          </p>
        </section>
      </section>
      <section>
        <h2>Properties Of Cue Sequences</h2>
        <section>
          <h2>WebVMT File Using Only Nested Cues</h2>
          <p>
            A <a>WebVMT file</a> whose cues all comply with the following rule is said to be a <dfn>WebVMT file using only nested cues</dfn>.
          </p>
          <p>
            Given any two cues <i>cue1</i> and <i>cue2</i> with start and end time offsets <i>(x1, y1)</i> and <i>(x2, y2)</i> respectively:
            <ul>
              <li>
                either <i>cue1</i> lies fully within <i>cue2</i>, i.e. <i>x1 >= x2</i> and <i>y1 <= y2</i>;
              </li>
              <li>
                or <i>cue1</i> fully contains <i>cue2</i>, i.e. <i>x1 <= x2</i> and <i>y1 >= y2</i>.
              </li>
            </ul>
          </p>
          <p>
            The following example matches this definition:
          </p>
          <pre class='nohighlight example' title='Nested Cues'>
WEBVMT

NOTE Required blocks omitted for clarity

00:00.000 --&gt; 01:24.000
{ "circle": { "lat": 0, "lng": 0, "rad": 2000 } }

00:00.000 --&gt; 00:44.000
{ "moveto": { "lat": 0, "lng": 0, "path": "cam1" } }
{ "lineto": { "lat": 0.12, "lng": 0.34, "path": "cam1" } }

00:44.000 --&gt; 01:19.000
{ "lineto": { "lat": 0.56, "lng": 0.78, "path": "cam1" } }

01:24.000 --&gt; 05:00.000
{ "circle": { "lat": 0, "lng": 0, "rad": 30000 } }

01:35.000 --&gt; 03:00.000
{ "moveto": { "lat": 0.87, "lng": 0.65, "path": "cam2" } }
{ "lineto": { "lat": 0.43, "lng": 0.21, "path": "cam2" } }

03:00.000 --&gt; 05:00.000
{ "lineto": { "lat": 0, "lng": 0, "path": "cam2" } }
          </pre>
          <p>
            Notice how you can express the cues in this WebVMT file as a tree structure:
          </p>
          <ul>
            <li>
              2km Circle at (0, 0)
              <ul>
                <li>
                  Line (0, 0) to (0.12, 0.34)
                </li>
                <li>
                  Line (0.12, 0.34) to (0.56, 0.78)
                </li>
              </ul>
            </li>
            <li>
              30km Circle at (0, 0)
              <ul>
                <li>
                  Line (0.87, 0.65) to (0.43, 0.21)
                </li>
                <li>
                  Line (0.43, 0.21) to (0, 0)
                </li>
              </ul>
            </li>
          </ul>
          <p>
            If the file has cues that can’t be expressed in this fashion, then they don’t match the definition of a <a>WebVMT file using only nested cues</a>. For example:
          </p>
          <pre class='nohighlight example' title='Non-Nested Cues'>
WEBVMT

NOTE Required blocks omitted for clarity

00:00.000 --&gt; 01:00.000
{ "moveto": { "lat": 0.12, "lng": 0.34, "path": "cam3" } }
{ "lineto": { "lat": 0.56, "lng": 0.78, "path": "cam3" } }

00:30.000 --&gt; 01:30.000
{ "moveto": { "lat": 0.87, "lng": 0.65, "path": "cam4" } }
{ "lineto": { "lat": 0.43, "lng": 0.21, "path": "cam4" } }
          </pre>
          <p>
            In this ninety-second example, the two cues partly overlap, with the first ending before the second ends and the second starting before the first ends. This therefore is not a <a>WebVMT file using only nested cues</a>.
          </p>
        </section>
      </section>
    </section>
    <section id='parsing'>
      <h2>Parsing</h2>
      <p>
        WebVMT file parsing is similar to <a data-cite='WEBVTT/#parsing'>WebVTT parsing</a>, though most of the steps can be skipped as WebVMT files are metadata files.
      </p>
      <section id='file-parsing'>
        <h2>WebVMT File Parsing</h2>
        <p>
          A <dfn>WebVMT parser</dfn>, given an input byte stream, a <a data-cite='HTML51/semantics-embedded-content.html#text-track-list-of-cues'>text track list of cues</a> |output|, and a collection of <a data-cite='CSSOM-1/#css-style-sheets'>CSS style sheets</a> |stylesheets|, must decode the byte stream using the UTF-8 decode algorithm, and then must parse the resulting string according to the <a>WebVMT parser algorithm</a>. This results in <a>WebVMT cues</a> being added to |output|, and <a data-cite='CSSOM-1/#css-style-sheets'>CSS style sheets</a> being added to |stylesheets|.
        </p>
        <p>
          A <a>WebVMT parser</a>, specifically its conversion and parsing steps, is typically run asynchronously, with the input byte stream being updated incrementally as the resource is downloaded; this is called an <dfn>incremental WebVMT parser</dfn>.
        </p>
        <p>
          A <a>WebVMT parser</a> verifies a file signature before parsing the provided byte stream. If the stream lacks this WebVMT file signature, then the parser aborts.
        </p>
        <p>
          The <dfn>WebVMT parser algorithm</dfn> is as follows:
        </p>
        <p>
          <ol>
            <li>
              Let |input| be the string being parsed, after conversion to Unicode, and with the following transformations applied:
            </li>
            <ul>
              <li>
                Replace all U+0000 NULL characters by U+FFFD REPLACEMENT CHARACTERs.
              </li>
              <li>
                Replace each U+000D CARRIAGE RETURN U+000A LINE FEED (CRLF) character pair by a single U+000A LINE FEED (LF) character.
              </li>
              <li>
                Replace all remaining U+000D CARRIAGE RETURN characters by U+000A LINE FEED (LF) characters.
              </li>
            </ul>
            <li>
              Let |position| be a pointer into |input|, initially pointing at the start of the string. In an <a>incremental WebVMT parser</a>, when this algorithm (or further algorithms that it uses) moves the |position| pointer, the user agent must wait until appropriate further characters from the byte stream have been added to |input| before moving the pointer, so that the algorithm never reads past the end of the |input| string. Once the byte stream has ended, and all characters have been added to |input|, then the |position| pointer may, when so instructed by the algorithms, be moved past the end of |input|.
            </li>
            <li>
              Let |seen cue| be false.
            </li>
            <li>
              If |input| is less than six characters long, then abort these steps. The file does not start with the correct <a>WebVMT file</a> signature and was therefore not successfully processed.
            </li>
            <li>
              If |input| is exactly six characters long but does not exactly equal "<code>WEBVMT</code>", then abort these steps. The file does not start with the correct <a>WebVMT file</a> signature and was therefore not successfully processed.
            </li>
            <li>
              If |input| is more than six characters long but the first six characters do not exactly equal "<code>WEBVMT</code>", or the seventh character is not a U+0020 SPACE character, a U+0009 CHARACTER TABULATION (tab) character, or a U+000A LINE FEED (LF) character, then abort these steps. The file does not start with the correct <a>WebVMT file</a> signature and was therefore not successfully processed.
            </li>
            <li>
              <a data-cite='HTML51/infrastructure.html#collect-a-sequence-of-code-points'>Collect a sequence of code points</a> that are not U+000A LINE FEED (LF) characters.
            </li>
            <li>
              If |position| is past the end of |input|, then abort these steps. The file was successfully processed, but it contains no useful data and so no <a>WebVMT cues</a> were added to |output|.
            </li>
            <li>
              The character indicated by |position| is a U+000A LINE FEED (LF) character. Advance |position| to the next character in |input|.
            </li>
            <li>
              If |position| is past the end of |input|, then abort these steps. The file was successfully processed, but it contains no useful data and so no <a>WebVMT cues</a> were added to output.
            </li>
            <li>
              <i>Header:</i> If the character indicated by |position| is not a U+000A LINE FEED (LF) character, then <a>collect a WebVMT block</a> with the |in header| flag set. Otherwise, advance |position| to the next character in |input|.
            </li>
            <li>
              <a data-cite='HTML51/infrastructure.html#collect-a-sequence-of-code-points'>Collect a sequence of code points</a> that are U+000A LINE FEED (LF) characters.
            </li>
            <li>
              Let |map| be null.
            </li>
            <li>
              Let |media metadata| be null.
            </li>
            <li>
              <i>Block loop:</i> While |position| doesn’t point past the end of |input|:
              <ol>
                <li>
                  <a>Collect a WebVMT block</a>, and let |block| be the returned value.
                </li>
                <li>
                  If |block| is a <a>WebVMT cue</a>, add |block| to the <a data-cite='HTML51/semantics-embedded-content.html#text-track-list-of-cues'>text track list of cues</a> |output|.
                </li>
                <li>
                  Otherwise, if |block| is a <a data-cite='CSSOM-1/#css-style-sheets'>CSS style sheet</a>, add |block| to |stylesheets|.
                </li>
                <li>
                  Otherwise, if |block| is a <a>WebVMT map object</a>, let |map| be |block|.
                </li>
                <li>
                  Otherwise, if |block| is a <a>WebVMT media object</a>, let |media metadata| be |block|.
                </li>
                <li>
                  <a data-cite='HTML51/infrastructure.html#collect-a-sequence-of-code-points'>Collect a sequence of code points</a> that are U+000A LINE FEED (LF) characters.
                </li>
              </ol>
            </li>
            <li>
              <i>End:</i> The file has ended. Abort these steps. The <a>WebVMT parser</a> has finished. The file was successfully processed.
            </li>
          </ol>
        </p>
        <p>
          When the algorithm above says to <dfn>collect a WebVMT block</dfn>, optionally with a flag |in header| set, the user agent must run the following steps:
        </p>
        <p>
          <ol>
            <li>
              Let |input|, |position| and |seen cue| be the same variables as those of the same name in the algorithm that invoked these steps.
            </li>
            <li>
              Let |line count| be zero.
            </li>
            <li>
              Let |previous position| be |position|.
            </li>
            <li>
              Let |line| be the empty string.
            </li>
            <li>
              Let |buffer| be the empty string.
            </li>
            <li>
              Let |seen EOF| be false.
            </li>
            <li>
              Let |seen arrow| be false.
            </li>
            <li>
              Let |cue| be null.
            </li>
            <li>
              Let |stylesheet| be null.
            </li>
            <li>
              Let |map| be null.
            </li>
            <li>
              Let |media metadata| be null.
            </li>
            <li>
              <i>Loop:</i> Run these substeps in a loop:
              <ol>
                <li>
                  <a data-cite='HTML51/infrastructure.html#collect-a-sequence-of-code-points'>Collect a sequence of code points</a> that are <i>not</i> U+000A LINE FEED (LF) characters. Let |line| be those characters, if any.
                </li>
                <li>
                  Increment |line count| by 1.
                </li>
                <li>
                  If |position| is past the end of |input|, let |seen EOF| be true. Otherwise, the character indicated by |position| is a U+000A LINE FEED (LF) character; advance |position| to the next character in |input|.
                </li>
                <li>
                  If |line| contains the three-character substring "--&gt;" (U+002D HYPHEN-MINUS, U+002D HYPHEN-MINUS, U+003E GREATER-THAN SIGN), then run these substeps:
                  <ol>
                    <li>
                      If |in header| is not set and at least one of the following conditions are true:
                      <ul>
                        <li>
                          |line count| is 1
                        </li>
                        <li>
                          |line count| is 2 and |seen arrow| is false
                        </li>
                      </ul>
                      ...then run these substeps:
                      <ol>
                        <li>
                          Let |seen arrow| be true.
                        </li>
                        <li>
                          Let |previous position| be |position|.
                        </li>
                        <li>
                          <i>Cue creation:</i> Let |cue| be a new <a>WebVMT cue</a> and initialize it as follows:
                          <ol>
                            <li>
                              Let |cue|'s <a data-cite='HTML51/semantics-embedded-content.html#text-track-cue-identifier'>text track cue identifier</a> be |buffer|.
                            </li>
                            <li>
                              Let |cue|'s <a data-cite='HTML51/semantics-embedded-content.html#text-track-cue-pause-on-exit-flag'>text track cue pause-on-exit flag</a> be false.
                            </li>
                            <li>
                              Let |cue|'s <a>cue text</a> be the empty string.
                            </li>
                          </ol>
                        </li>
                        <li>
                          <a>Collect WebVMT cue timings</a> from |line| for |cue|. If that fails, let |cue| be null. Otherwise, let |buffer| be the empty string and let |seen cue| be true.
                        </li>
                      </ol>
                      Otherwise, let |position| be |previous position| and break out of <i>loop</i>.
                    </li>
                  </ol>
                  <li>
                    Otherwise, if |line| is the empty string, break out of <i>loop</i>.
                  </li>
                  <li>
                    Otherwise, run these substeps:
                    <ol>
                      <li>
                        If |in header| is not set and |line count| is 2, run these substeps:
                        <ol>
                          <li>
                            If |seen cue| is false and |buffer| starts with the substring "<code>STYLE</code>" (U+0053 LATIN CAPITAL LETTER S, U+0054 LATIN CAPITAL LETTER T, U+0059 LATIN CAPITAL LETTER Y, U+004C LATIN CAPITAL LETTER L, U+0045 LATIN CAPITAL LETTER E), and the remaining characters in |buffer| (if any) are all <a data-cite='HTML51/infrastructure.html#space-characters'>ASCII whitespace</a>, then run these substeps:
                            <ol>
                              <li>
                                <p>
                                  Let |stylesheet| be the result of <a data-cite='CSSOM-1/#create-a-css-style-sheet'>creating a CSS style sheet</a>, with the following properties:
                                </p>
                                <dl>
                                  <dt>
                                    <a data-cite='CSSOM-1/#concept-css-style-sheet-location'>location</a>
                                  </dt>
                                  <dd>
                                    null
                                  </dd>
                                  <dt>
                                    <a data-cite='CSSOM-1/#concept-css-style-sheet-parent-css-style-sheet'>parent CSS style sheet</a>
                                  </dt>
                                  <dd>
                                    null
                                  </dd>
                                  <dt>
                                    <a data-cite='CSSOM-1/#concept-css-style-sheet-owner-node'>owner node</a>
                                  </dt>
                                  <dd>
                                    null
                                  </dd>
                                  <dt>
                                    <a data-cite='CSSOM-1/#concept-css-style-sheet-owner-css-rule'>owner CSS rule</a>
                                  </dt>
                                  <dd>
                                    null
                                  </dd>
                                  <dt>
                                    <a data-cite='CSSOM-1/#concept-css-style-sheet-media'>media</a>
                                  </dt>
                                  <dd>
                                    The empty string.
                                  </dd>
                                  <dt>
                                    <a data-cite='CSSOM-1/#concept-css-style-sheet-title'>title</a>
                                  </dt>
                                  <dd>
                                    The empty string.
                                  </dd>
                                  <dt>
                                    <a data-cite='CSSOM-1/#concept-css-style-sheet-alternate-flag'>alternate flag</a>
                                  </dt>
                                  <dd>
                                    Unset.
                                  </dd>
                                  <dt>
                                    <a data-cite='CSSOM-1/#concept-css-style-sheet-origin-clean-flag'>origin-clean flag</a>
                                  </dt>
                                  <dd>
                                    Set.
                                  </dd>
                                </dl>
                              </li>
                              <li>
                                Let |buffer| be the empty string.
                              </li>
                            </ol>
                          </li>
                          <li>
                            Otherwise, if |seen cue| is false and |buffer| starts with the substring "<code>MAP</code>" (U+004D LATIN CAPITAL LETTER M, U+0041 LATIN CAPITAL LETTER A, U+0050 LATIN CAPITAL LETTER P), and the remaining characters in |buffer| (if any) are all <a data-cite='HTML51/infrastructure.html#space-characters'>ASCII whitespace</a>, then run these substeps:
                            <ol>
                              <li>
                                <i>Map creation:</i> Let |map| be a new <a>WebVMT map</a>.
                              </li>
                              <li>
                                Let |buffer| be the empty string.
                              </li>
                            </ol>
                          </li>
                          <li>
                            Otherwise, if |seen cue| is false and |buffer| starts with the substring "<code>MEDIA</code>" (U+004D LATIN CAPITAL LETTER M, U+0045 LATIN CAPITAL LETTER E, U+0044 LATIN CAPITAL LETTER D, U+0049 LATIN CAPITAL LETTER I, U+0041 LATIN CAPITAL LETTER A), and the remaining characters in |buffer| (if any) are all <a data-cite='HTML51/infrastructure.html#space-characters'>ASCII whitespace</a>, then run these substeps:
                            <ol>
                              <li>
                                <i>Media creation:</i> Let |media metadata| be a new <a>WebVMT media</a>.
                              </li>
                              <li>
                                Let |buffer| be the empty string.
                              </li>
                            </ol>
                          </li>
                        </ol>
                      </li>
                      <li>
                        If |buffer| is not the empty string, append a U+000A LINE FEED (LF) character to |buffer|.
                      </li>
                      <li>
                        Append |line| to |buffer|.
                      </li>
                      <li>
                        Let |previous position| be |position|.
                      </li>
                    </ol>
                  </li>
                </li>
                <li>
                  If |seen EOF| is true, break out of <i>loop</i>.
                </li>
              </ol>
            </li>
            <li>
              If |cue| is not null, let the <a>cue text</a> of |cue| be |buffer|, and return |cue|.
            </li>
            <li>
              Otherwise, if |stylesheet| is not null, then <a data-cite='CSS-SYNTAX-3/#parse-a-stylesheet'>parse a stylesheet</a> from |buffer|. If it returned a list of rules, assign the list as |stylesheet|'s <a data-cite='CSSOM-1/#concept-css-style-sheet-css-rules'>CSS rules</a>; otherwise, set |stylesheet|'s <a data-cite='CSSOM-1/#concept-css-style-sheet-css-rules'>CSS rules</a> to an empty list. Finally, return |stylesheet|.
            </li>
            <li>
              Otherwise, if |map| is not null, then <a>collect WebVMT map settings</a> from |buffer| using |map| for the results. Construct a <a>WebVMT map object</a> from |map|, and return it.
            </li>
            <li>
              Otherwise, if |media metadata| is not null, then <a>collect WebVMT media settings</a> from |buffer| using |media metadata| for the results. Construct a <a>WebVMT media object</a> from |media metadata|, and return it.
            </li>
            <li>
              Otherwise, return null.
            </li>
          </ol>
        </p>
      </section>
      <section id='map-settings-parsing'>
        <h2>WebVMT Map Settings Parsing</h2>
        <p>
          When the <a>WebVMT parser</a> algorithm says to <dfn>collect WebVMT map settings</dfn> from a string |input| for a <a data-cite='HTML51/semantics-embedded-content.html#text-tracks'>text track</a>, the user agent must run the following algorithm.
        </p>
        <p>
          A <dfn>WebVMT map object</dfn> is a conceptual construct to represent a <a>WebVMT map</a> that is used as a root node for <a>WebVMT node objects</a>. This algorithm returns a <a>WebVMT map object</a>.
        </p>
        <p>
          <ol>
            <li>
              Let |settings| be the result of <a data-cite='HTML51/infrastructure.html#split-a-string-on-spaces'>splitting |input| on spaces</a>.
            </li>
            <li>
              For each token |setting| in the list |settings|, run the following substeps:
              <ol>
                <li>
                  If |setting| does not contain a U+003A COLON character (:), or if the first U+003A COLON character (:) in |setting| is either the first or last character of |setting|, then jump to the step labeled <i>next setting</i>.
                </li>
                <li>
                  Let |name| be the leading substring of |setting| up to and excluding the first U+003A COLON character (:) in that string.
                </li>
                <li>
                  Let |value| be the trailing substring of |setting| starting from the character immediately after the first U+003A COLON character (:) in that string.
                </li>
                <li>
                  Run the appropriate substeps that apply for the value of |name|, as follows:
                </li>
                <dl>
                  <dt>
                    If |name| is a case-sensitive match for "<code>lat</code>"
                  </dt>
                  <dd>
                    Let |map|'s <a>location latitude</a> of the <a>map center location</a> be |value|.
                  </dd>
                  <dt>
                    Otherwise if |name| is a case-sensitive match for "<code>lng</code>"
                  </dt>
                  <dd>
                    Let |map|'s <a>location longitude</a> of the <a>map center location</a> be |value|.
                  </dd>
                  <dt>
                    Otherwise if |name| is a case-sensitive match for "<code>alt</code>"
                  </dt>
                  <dd>
                    Let |map|'s <a>location altitude</a> of the <a>map center location</a> be |value|.
                  </dd>
                  <dt>
                    Otherwise if |name| is a case-sensitive match for "<code>rad</code>"
                  </dt>
                  <dd>
                    Let |map|'s <a>map zoom radius</a> be |value|.
                  </dd>
                </dl>
                <li>
                  <i>Next setting:</i> Continue to the next setting, if any.
                </li>
              </ol>
            </li>
          </ol>
        </p>
      </section>
      <section id='media-settings-parsing'>
        <h2>WebVMT Media Settings Parsing</h2>
        <p>
          When the <a>WebVMT parser</a> algorithm says to <dfn>collect WebVMT media settings</dfn> from a string |input| for a <a data-cite='HTML51/semantics-embedded-content.html#text-tracks'>text track</a>, the user agent must run the following algorithm.
        </p>
        <p>
          A <dfn>WebVMT media object</dfn> is a conceptual construct to represent a <a>WebVMT media</a>. This algorithm returns a <a>WebVMT media object</a>.
        </p>
        <p>
          <ol>
            <li>
              Let |settings| be the result of <a data-cite='HTML51/infrastructure.html#split-a-string-on-spaces'>splitting |input| on spaces</a>.
            </li>
            <li>
              For each token |setting| in the list |settings|, run the following substeps:
              <ol>
                <li>
                  If |setting| does not contain a U+003A COLON character (:), or if the first U+003A COLON character (:) in |setting| is either the first or last character of |setting|, then jump to the step labeled <i>next setting</i>.
                </li>
                <li>
                  Let |name| be the leading substring of |setting| up to and excluding the first U+003A COLON character (:) in that string.
                </li>
                <li>
                  Let |value| be the trailing substring of |setting| starting from the character immediately after the first U+003A COLON character (:) in that string.
                </li>
                <li>
                  Run the appropriate substeps that apply for the value of |name|, as follows:
                </li>
                <dl>
                  <dt>
                    If |name| is a case-sensitive match for "<code>url</code>"
                  </dt>
                  <dd>
                    Let |media metadata|'s <a>media URL</a> be |value|.
                  </dd>
                  <dt>
                    Otherwise if |name| is a case-sensitive match for "<code>mimetype</code>"
                  </dt>
                  <dd>
                    Let |media metadata|'s <a>media MIME type</a> be |value|.
                  </dd>
                  <dt>
                    Otherwise if |name| is a case-sensitive match for "<code>starttime</code>"
                  </dt>
                  <dd>
                    Let |media metadata|'s <a>media start time</a> be |value|.
                  </dd>
                  <dt>
                    Otherwise if |name| is a case-sensitive match for "<code>path</code>"
                  </dt>
                  <dd>
                    Let |media metadata|'s <a>media path</a> be |value|.
                  </dd>
                </dl>
                <li>
                  <i>Next setting:</i> Continue to the next setting, if any.
                </li>
              </ol>
            </li>
          </ol>
        </p>
      </section>
      <section id='cue-timings-parsing'>
        <h2>WebVMT Cue Timings Parsing</h2>
        <p>
          When the algorithm above says to <dfn>collect WebVMT cue timings</dfn> from a string |input| for a <a>WebVMT cue</a> |cue|, the user agent must run the following algorithm.
        </p>
        <p>
          <ol>
            <li>
              Let |input| be the string being parsed.
            </li>
            <li>
              Let |position| be a pointer into |input|, initially pointing at the start of the string.
            </li>
            <li>
              <a data-cite='HTML51/infrastructure.html#skip-ascii-whitespace'>Skip whitespace</a>.
            </li>
            <li>
              <a>Collect a WebVMT timestamp</a>. If that algorithm fails, then abort these steps and return failure. Otherwise, let |cue|'s <a data-cite='HTML51/semantics-embedded-content.html#text-track-cue-start-time'>text track cue start time</a> be the collected time.
            </li>
            <li>
              <a data-cite='HTML51/infrastructure.html#skip-ascii-whitespace'>Skip whitespace</a>.
            </li>
            <li>
              If the character at |position| is not a U+002D HYPHEN-MINUS character (-) then abort these steps and return failure. Otherwise, move |position| forwards one character.
            </li>
            <li>
              If the character at |position| is not a U+002D HYPHEN-MINUS character (-) then abort these steps and return failure. Otherwise, move |position| forwards one character.
            </li>
            <li>
              If the character at |position| is not a U+003E GREATER-THAN SIGN character (>) then abort these steps and return failure. Otherwise, move |position| forwards one character.
            </li>
            <li>
              <a data-cite='HTML51/infrastructure.html#skip-ascii-whitespace'>Skip whitespace.</a>
            </li>
            <li>
              If |position| is not past the end of |input| and the character at |position| is an <a data-cite='HTML51/infrastructure.html#ascii-digit'>ASCII digit</a>, <a>collect a WebVMT timestamp</a>. If that algorithm fails, then abort these steps and return failure. Otherwise, let |cue|'s <a data-cite='HTML51/semantics-embedded-content.html#text-track-cue-end-time'>text track cue end time</a> be the collected time.
            </li>
            <li>
              Otherwise (|position| is past the end of |input| or the character at |position| is not an <a data-cite='HTML51/infrastructure.html#ascii-digit'>ASCII digit</a>), let |cue|'s <a data-cite='HTML51/semantics-embedded-content.html#text-track-cue-end-time'>text track cue end time</a> be the value positive Infinity.
            </li>
          </ol>
        </p>
        <p>
          When this specification says that a user agent is to <dfn>collect a WebVMT timestamp</dfn>, the user agent must run the following steps:
        </p>
        <p>
          <ol>
            <li>
              Let |input| and |position| be the same variables as those of the same name in the algorithm that invoked these steps.
            </li>
            <li>
              Let |most significant units| be <i>minutes</i>.
            </li>
            <li>
              If |position| is past the end of |input|, return an error and abort these steps.
            </li>
            <li>
              If the character indicated by |position| is not an <a data-cite='HTML51/infrastructure.html#ascii-digit'>ASCII digit</a>, then return an error and abort these steps.
            </li>
            <li>
              <a data-cite='HTML51/infrastructure.html#collect-a-sequence-of-code-points'>Collect a sequence of code points</a> that are <a data-cite='HTML51/infrastructure.html#ascii-digit'>ASCII digits</a>, and let |string| be the collected substring.
            </li>
            <li>
              Interpret |string| as a base-ten integer. Let |value1| be that integer.
            </li>
            <li>
              If |string| is not exactly two characters in length, or if |value1| is greater than 59, let |most significant units| be <i>hours</i>.
            </li>
            <li>
              If |position| is beyond the end of |input| or if the character at |position| is not a U+003A COLON character (:), then return an error and abort these steps. Otherwise, move |position| forwards one character.
            </li>
            <li>
              <a data-cite='HTML51/infrastructure.html#collect-a-sequence-of-code-points'>Collect a sequence of code points</a> that are <a data-cite='HTML51/infrastructure.html#ascii-digit'>ASCII digits</a>, and let |string| be the collected substring.
            </li>
            <li>
              If |string| is not exactly two characters in length, return an error and abort these steps.
            </li>
            <li>
              Interpret |string| as a base-ten integer. Let |value2| be that integer.
            </li>
            <li>
              If |most significant units| is <i>hours</i>, or if |position| is not beyond the end of |input| and the character at |position| is a U+003A COLON character (:), run these substeps:
              <ol>
                <li>
                  If |position| is beyond the end of |input| or if the character at |position| is not a U+003A COLON character (:), then return an error and abort these steps. Otherwise, move |position| forwards one character.
                </li>
                <li>
                  <a data-cite='HTML51/infrastructure.html#collect-a-sequence-of-code-points'>Collect a sequence of code points</a> that are <a data-cite='HTML51/infrastructure.html#ascii-digit'>ASCII digits</a>, and let |string| be the collected substring.
                </li>
                <li>
                  If |string| is not exactly two characters in length, return an error and abort these steps.
                </li>
                <li>
                  Interpret |string| as a base-ten integer. Let |value3| be that integer.
                </li>
              </ol>
              Otherwise (if |most significant units| is not <i>hours</i>, and either |position| is beyond the end of |input|, or the character at |position| is not a U+003A COLON character (:)), let |value3| have the value of |value2|, then |value2| have the value of |value1|, then let |value1| equal zero.
            </li>
            <li>
              If |position| is beyond the end of |input| or if the character at |position| is not a U+002E FULL STOP character (.), then return an error and abort these steps. Otherwise, move |position| forwards one character.
            </li>
            <li>
              <a data-cite='HTML51/infrastructure.html#collect-a-sequence-of-code-points'>Collect a sequence of code points</a> that are <a data-cite='HTML51/infrastructure.html#ascii-digit'>ASCII digits</a>, and let |string| be the collected substring.
            </li>
            <li>
              If |string| is not exactly three characters in length, return an error and abort these steps.
            </li>
            <li>
              Interpret |string| as a base-ten integer. Let |value4| be that integer.
            </li>
            <li>
              If |value2| is greater than 59 or if |value3| is greater than 59, return an error and abort these steps.
            </li>
            <li>
              Let |result| be |value1|×60×60 + |value2|×60 + |value3| + |value4|∕1000.
            </li>
            <li>
              Return |result|.
            </li>
          </ol>
        </p>
      </section>
    <!--
      <section id='cue-text-parsing'>
        <h2>WebVMT Cue Text Parsing</h2>
        <p>
          A <dfn>WebVMT node object</dfn> is a conceptual construct used to represent components of cue text so that its processing can be described without reference to the underlying syntax.
        </p>
        <p>
          There are two broad classes of <a>WebVMT node objects</a>: <a>WebVMT internal node objects</a> and <a>WebVMT leaf node objects</a>.
        </p>
        <p>
          <dfn>WebVMT internal node objects</dfn> are those that can contain further <a>WebVMT node objects</a>. They are conceptually similar to elements in HTML or the DOM. <a>WebVMT internal node objects</a> have an ordered list of child <a>WebVMT node objects</a>. The <a>WebVMT internal node object</a> is said to be the parent of the children. Cycles do not occur; the parent-child relationships so constructed form a tree structure.
        </p>
        <p>
          There are several concrete classes of <a>WebVMT internal node objects</a>:
        </p>
        <dl>
          <dt>
            <dfn>List of WebVMT node objects</dfn>
          </dt>
          <dd>
            This is used as a root node for trees of <a>WebVMT node objects</a>.
          </dd>
          <dt>
            A <dfn>WebVMT zone object</dfn>
          </dt>
          <dd>
            This represents the span of a <a>WebVMT zone fragment</a> in a <a>WebVMT cue</a>.
          </dd>
          <dt>
            A <dfn>WebVMT path object</dfn>
          </dt>
          <dd>
            This represents the span of a <a>WebVMT path fragment</a> in a <a>WebVMT cue</a>.
          </dd>
        </dl>
        <p>
          <dfn>WebVMT leaf node objects</dfn> are those that contain data, such as text, and cannot contain child <a>WebVMT node objects</a>.
        </p>
        <p>
          There is one concrete class of <a>WebVMT leaf node objects</a>:
        </p>
        <dl>
          <dt>
            <dfn>WebVMT text object</dfn>
          </dt>
          <dd>
            A text string. A <a>WebVMT text object</a> has a value which is the <a data-cite='ECMA-404' data-no-xref=''>JSON text</a> of a timed metadata object.
          </dd>
          <!--dt>
            <dfn>WebVMT data object</dfn>
          </dt>
          <dd>
            A timed metadata object. A <a>WebVMT data object</a> is a JSON object which represents the timed metadata structure and its values.
          </dd!->
        </dl>
        <p>
          The <dfn>WebVMT cue text parsing rules</dfn> consist of the following algorithm. The input is a string |input| supposedly containing <a>WebVMT metadata text</a>. This algorithm returns a <a>list of WebVMT node objects</a>.
        </p>
        <p>
          <ol>
            <li>
              Let |input| be the string being parsed.
            </li>
            <li>
              Let |position| be a pointer into |input|, initially pointing at the start of the string.
            </li>
            <li>
              Let |json| be an empty string.
            </li>
            <li>
              Let |result| be a <a>list of WebVMT node objects</a>, initially empty.
            </li>
            <li>
              Let |current| be the <a>WebVMT internal node object</a> |result|.
            </li>
            <li>
              <i>Loop:</i> If |position| is past the end of |input|, return |result| and abort these steps.
            </li>
            <li>
              <a>Collect a JSON element text</a>. If that algorithm fails, then abort these steps and return failure. Otherwise, let |json| be the collected string.
            </li>
            <li>
              Create a <a>WebVMT text object</a> whose value is the value of the string |json|.
            </li>
            <li>
              Append the newly created <a>WebVMT text object</a> to |current|.
            </li>
            <li>
              Jump to the step labeled <i>loop</i>.
            </li>
          </ol>
        </p>
        <p>
          When this specification says that a user agent is to <dfn>collect a JSON element text</dfn>, the user agent must run the following steps:
        </p>
        <p>
          <ol>
            <li>
              Let |input| and |position| be the same variables as those of the same name in the algorithm that invoked these steps.
            </li>
            <li>
              Let |string| be an empty string.
            <li>
              <i>Loop:</i> If |position| is past the end of |input|, return |string| and abort these steps.
            </li>
            <li>
              Let |c| be the character in |input| pointed to by |position|.
            </li>
            <li>
              <p>
                Jump to the entry that matches the value of |c|:
              </p>
              <dl>
                <dt>
                  U+007B LEFT CURLY BRACKET character ({)
                </dt>
                <dd>
                  <a>Collect a JSON object text</a>. If that algorithm fails, then abort these steps and return failure. Otherwise, return the collected string and abort these steps.
                </dd>
                <dt>
                  U+005B LEFT SQUARE BRACKET character ([)
                </dt>
                <dd>
                  <a>Collect a JSON array text</a>. If that algorithm fails, then abort these steps and return failure. Otherwise, return the collected string and abort these steps.
                </dd>
                <dt>
                  Anything else
                </dt>
                <dd>
                  Advance |position| to the next character in |input|.
                </dd>
              </dl>
            </li>
            <li>
              Jump to the step labeled <i>loop</i>.
            </li>
          </ol>
        </p>
        <p>
          When this specification says that a user agent is to <dfn>collect a JSON object text</dfn>, the user agent must run the following steps:
        </p>
        <p>
          <ol>
            <li>
              Let |input|, |position| and |string| be the same variables as those of the same name in the algorithm that invoked these steps.
            </li>
            <li>
              Let |c| be the character in |input| pointed to by |position|.
            </li>
            <li>
              If |c| is not a U+007B LEFT CURLY BRACKET character ({) then return failure and abort these steps. Otherwise, append |c| to |string| and advance |position| to the next character in |input|.
            </li>
            <li>
              <i>Loop:</i> If |position| is past the end of |input|, return |string| and abort these steps.
            </li>
            <li>
              <a data-cite='HTML51/infrastructure.html#skip-ascii-whitespace'>Skip whitespace.</a>
            </li>
            <li>
              <a>Collect a JSON string text</a>. If that algorithm fails, then abort these steps and return failure. Otherwise, append the collected string to |string|.
            </li>
            <li>
              <a data-cite='HTML51/infrastructure.html#skip-ascii-whitespace'>Skip whitespace.</a>
            </li>
            <li>
              Let |c| be the character in |input| pointed to by |position|.
            </li>
            <li>
              If |c| is not a U+003A COLON character (:) then return failure and abort these steps. Otherwise, append |c| to |string| and advance |position| to the next character in |input|.
            </li>
            <li>
              <a>Collect a JSON value text</a>. If that algorithm fails, then abort these steps and return failure.
            </li>
            <li>
              Let |c| be the character in |input| pointed to by |position|.
            </li>
            <li>
              If |c| is a U+007D RIGHT CURLY BRACKET character (}) then append |c| to |string|, advance |position| to the next character in |input|, return |string| and abort these steps.
            </li>
            <li>
              Otherwise, if |c| is not a U+002C COMMA character (,) then return failure and abort these steps.
            </li>
            <li>
              Append |c| to |string| and advance |position| to the next character in |input|.
            </li>
            <li>
              Jump to the step labeled <i>loop</i>.
            </li>
          </ol>
        </p>
        <p>
          When this specification says that a user agent is to <dfn>collect a JSON array text</dfn>, the user agent must run the following steps:
        </p>
        <p>
          <ol>
            <li>
              Let |input|, |position| and |string| be the same variables as those of the same name in the algorithm that invoked these steps.
            </li>
            <li>
              Let |c| be the character in |input| pointed to by |position|.
            </li>
            <li>
              If |c| is not a U+005B LEFT BRACKET character ([) then return failure and abort these steps. Otherwise, append |c| to |string| and advance |position| to the next character in |input|.
            </li>
            <li>
              <i>Loop:</i> If |position| is past the end of |input|, return |string| and abort these steps.
            </li>
            <li>
              <a>Collect a JSON value text</a>. If that algorithm fails, then abort these steps and return failure.
            </li>
            <li>
              Let |c| be the character in |input| pointed to by |position|.
            </li>
            <li>
              If |c| is a U+005D RIGHT BRACKET character (]) then append |c| to |string|, advance |position| to the next character in |input|, return |string| and abort these steps.
            </li>
            <li>
              Otherwise, if |c| is not a U+002C COMMA character (,) then return failure and abort these steps.
            </li>
            <li>
              Append |c| to |string| and advance |position| to the next character in |input|.
            </li>
            <li>
              Jump to the step labeled <i>loop</i>.
            </li>
          </ol>
        </p>
        <p>
          When this specification says that a user agent is to <dfn>collect a JSON value text</dfn>, the user agent must run the following steps:
        </p>
        <p>
          <ol>
            <li>
              Let |input|, |position| and |string| be the same variables as those of the same name in the algorithm that invoked these steps.
            </li>
            <li>
              <a data-cite='HTML51/infrastructure.html#skip-ascii-whitespace'>Skip whitespace.</a>
            </li>
            <li>
              Let |c| be the character in |input| pointed to by |position|.
            </li>
            <dl>
              Jump to the entry that matches the value of |c|:
              <dt>
                U+0022 QUOTATION MARK character (")
              </dt>
              <dd>
                <a>Collect a JSON string text</a>. If that algorithm fails, then abort these steps and return failure. Otherwise, return the collected string and abort these steps.
              </dd>
              <dt>
                U+007B LEFT CURLY BRACKET character ({)
              </dt>
              <dd>
                <a>Collect a JSON object text</a>. If that algorithm fails, then abort these steps and return failure. Otherwise, return the collected string and abort these steps.
              </dd>
              <dt>
                U+005B LEFT SQUARE BRACKET character ([)
              </dt>
              <dd>
                <a>Collect a JSON array text</a>. If that algorithm fails, then abort these steps and return failure. Otherwise, return the collected string and abort these steps.
              </dd>
              <dt>
                Anything else
              </dt>
              <dd>
                Jump to the step labeled <i>loop</i>.
              </dd>
            </dl>
            <li>
              <i>Loop:</i> If |position| is past the end of |input|, return |string| and abort these steps.
            </li>
            <li>
              If |c| is <a data-cite='HTML51/infrastructure.html#ascii-whitespace'>ASCII whitespace</a> character then <a data-cite='HTML51/infrastructure.html#skip-ascii-whitespace'>skip whitespace</a>, return |string| and abort these steps.
            </li>
            <li>
              Otherwise, append |c| to |string| and advance |position| to the next character in |input|.
            </li>
            <li>
              Let |c| be the character in |input| pointed to by |position|.
            </li>
            <li>
              Jump to the step labeled <i>loop</i>.
            </li>
          </ol>
        </p>
        <p>
          When this specification says that a user agent is to <dfn>collect a JSON string text</dfn>, the user agent must run the following steps:
        </p>
        <p>
          <ol>
            <li>
              Let |input|, |position| and |string| be the same variables as those of the same name in the algorithm that invoked these steps.
            </li>
            <li>
              Let |c| be the character in |input| pointed to by |position|.
            </li>
            <li>
              If |c| is not a U+0022 QUOTATION MARK character (") then return failure and abort these steps. Otherwise, append |c| to |string| and advance |position| to the next character in |input|.
            </li>
            <li>
              <i>Loop:</i> If |position| is past the end of |input|, return |string| and abort these steps.
            </li>
            <li>
              Let |c| be the character in |input| pointed to by |position|.
            </li>
            <li>
              If |c| is a U+0022 QUOTATION MARK character (") then append |c| to |string| and advance |position| to the next character in |input|, return |string| and abort these steps.
            </li>
            <li>
              Otherwise, if |c| is a U+005C REVERSE SOLIDUS character (\) then <a>collect JSON escape text</a>. If that algorithm fails, then abort these steps and return failure. Otherwise, append the collected string to |string|.
            </li>
            <li>
              Otherwise, append |c| to |string| and advance |position| to the next character in |input|.
            </li>
            <li>
              Jump to the step labeled <i>loop</i>.
            </li>
          </ol>
        </p>
        <p>
          When this specification says that a user agent is to <dfn>collect JSON escape text</dfn>, the user agent must run the following steps:
        </p>
        <p>
          <ol>
            <li>
              Let |input|, |position| and |string| be the same variables as those of the same name in the algorithm that invoked these steps.
            </li>
            <li>
              Let |c| be the character in |input| pointed to by |position|.
            </li>
            <li>
              If |c| is not a U+005C REVERSE SOLIDUS character (\) then return failure and abort these steps. Otherwise, append |c| to |string| and advance |position| to the next character in |input|.
            </li>
            <li>
              If |position| is past the end of |input|, return |string| and abort these steps.
            </li>
            <li>
              Let |c| be the character in |input| pointed to by |position|.
            </li>
            <li>
              Append |c| to |string| and advance |position| to the next character in |input|.
            </li>
            <li>
              If |c| is a U+0075 LATIN SMALL LETTER U character (u) then run the following substeps:
              <ol>
                <li>
                  <a data-cite='HTML51/infrastructure.html#collect-a-sequence-of-code-points'>Collect a sequence of code points</a> that are <a data-cite='HTML51/infrastructure.html#ascii-hex-digits'>ASCII hex digits</a> and no more than four characters in length, and let |hex| be the collected substring.
                </li>
                <li>
                  If |hex| is not exactly four characters in length, return an error and abort these steps.
                </li>
                <li>
                  Append |hex| to |string|.
                </li>
              </ol>
            </li>
            <li>
              Return |string|.
            </li>
          </ol>
        </p>
      </section>
    -->
    </section>
    <!--
    <section id='rendering'>
      <h2>Rendering</h2>
      <p class='note'>
        This section describes how to visually render <a>WebVMT cues</a> in a user agent. The processing model is quite tightly linked to media elements in HTML, where CSS is available. <a>User agents that do not support CSS</a> are expected to render cues without styling features. <a>User agents that do not support a full HTML CSS engine</a> are expected to render an equivalent visual representation to what a user agent with a full CSS engine would render.
      </p>
      <!--
      <section id='processing-model'>
        <h2>Processing Model</h2>
        <p>
          The <dfn>rules for updating the display of WebVMT text tracks</dfn> render the <a data-cite='HTML51/semantics-embedded-content.html#text-track'>text tracks</a> of a <a data-cite='HTML51/semantics-embedded-content.html#media-element'>media element</a> (either a <a data-cite='HTML51/semantics-embedded-content.html#the-video-element'><code>&lt;video&gt;</code></a> or <a data-cite='HTML51/semantics-embedded-content.html#the-audio-element'><code>&lt;audio&gt;</code></a> element), or of another playback mechanism, by applying the steps below.
        </p>
        <p class='note'>
          When authors create WebVMT metadata, they need to publish them with a <a data-cite='HTML51/semantics-embedded-content.html#the-div-element'><code>&lt;div&gt;</code></a> element for rendering the map viewport by the user agent. This is associated using the <code>for</code> attribute of the <a data-cite='HTML51/semantics-embedded-content.html#the-track-element'><code>&lt;track&gt;</code></a> element.
        </p>
        <p>
          The output of the steps below is a set of CSS boxes that covers the rendering area of the <a data-cite='HTML51/semantics-embedded-content.html#the-div-element'><code>&lt;div&gt;</code></a> element, which user agents are expected to render in a manner suiting the user.
        </p>
        <p>
          The rules are as follows:
          <ol>
            <!--li>
              If the <a data-cite='HTML51/semantics-embedded-content.html#media-element'>media element</a> has no associated <a data-cite='HTML51/semantics-embedded-content.html#the-div-element'><code>&lt;div&gt;</code></a> element for rendering the map viewport, abort these steps.
            </li!->
            <li>
              Let |media| be the <a data-cite='HTML51/semantics-embedded-content.html#media-element'>media element</a> or other playback mechanism.
            </li>
            <li>
              Let |output| be an empty list of absolutely positioned CSS block boxes.
            </li>
            <!--li>
              If the user agent is <a data-cite='HTML51/semantics-embedded-content.html#expose-a-user-interface-to-the-user'>exposing a user interface</a> for |media|, add to |output| one or more completely transparent positioned CSS block boxes that cover the same region as the <a>WebVMT maps</a> in |maps|.
            </li!->
            <li>
              If the last time these rules were run, the user agent was not <a data-cite='HTML51/semantics-embedded-content.html#expose-a-user-interface-to-the-user'>exposing a user interface</a> for |media|, but now it is, optionally let |reset| be true. Otherwise, let |reset| be false.
            </li>
            <li>
              Let |tracks| be the subset of |media|'s <a data-cite='HTML51/semantics-embedded-content.html#list-of-text-tracks'>list of text tracks</a> that have as their <a data-cite='HTML51/semantics-embedded-content.html#rules-for-updating-the-text-track-rendering'>rules for updating the text track rendering</a> these <a>rules for updating the display of WebVMT text tracks</a>, and whose <a data-cite='HTML51/semantics-embedded-content.html#text-track-mode'>text track mode</a> is <a data-cite='HTML51/semantics-embedded-content.html#text-track-showing'>showing</a>.
            </li>
            <li>
              Let |cues| be an empty list of <a data-cite='HTML51/semantics-embedded-content.html#text-track-cue'>text track cues</a>.
            </li>
            <li>
              For each track |track| in |tracks|, append to |cues| all the <a data-cite='HTML51/semantics-embedded-content.html#text-track-cue'>cues</a> from |track|’s <a data-cite='HTML51/semantics-embedded-content.html#text-track-list-of-cues'>list of cues</a> that have their <a data-cite='HTML51/semantics-embedded-content.html#text-track-cue-active-flag'>text track cue active flag</a> set.
            </li>
            <li>
              Let |maps| be an empty list of <a>WebVMT maps</a>.
            </li>
            <li>
              For each track |track| in |tracks|, append to |maps| the map equal to the |track|'s <a>text track map</a>.
            </li>
            <li>
              If |reset| is false, then, for each <a>WebVMT map</a> |map| in |maps| let |mapNode| be a <a>WebVMT map object</a>.
            </li>
            <li>
              Apply the following steps for each |mapNode|:
              <ol>
                <li>
                  Apply the terms of the CSS specifications to |mapNode| within the following constraints, thus obtaining a CSS box |box| positioned relative to an initial containing block:
                </li>
                <ol>
                  <li>
                    No style sheets are associated with |mapNode|. (The mapNodes are subsequently restyled using style sheets after their boxes are generated, as described below.)
                  </li>
                  <li>
                    Properties on |mapNode| have their values set as defined in the next section. (That section uses some of the variables whose values were calculated earlier in this algorithm.)
                  </li>
                  <li>
                    The map viewport (and initial containing block) is map's rendering area.
                  </li>
                </ol>
                <li>
                  Add the CSS box |box| to |output|.
                </li>
              </ol>
            </li>
            <li>
              If |reset| is false, then, for each <a>WebVMT cue</a> |cue| in |cues|: if |cue|'s <a data-cite='HTML51/semantics-embedded-content.html#text-track-cue-display-state'>text track cue display state</a> has a set of CSS boxes, then add those boxes to that map's |box| and remove |cue| from |cues|.
            </li>
            <li>
              For each <a>WebVMT cue</a> |cue| in |cues| that has not yet had corresponding CSS boxes added to |output|, in <a data-cite='HTML51/semantics-embedded-content.html#text-track-cue-order'>text track cue order</a>, run the following substeps:
              <ol>
                <li>
                  Let |nodes| be the <a>list of WebVMT node objects</a> obtained by applying the <a>WebVMT cue text parsing rules</a>, to the |cue|'s <a>cue text</a>.
                </li>
                <li>
                  Run the following substeps:
                  <ol>
                    <li>
                      Let |map| be |track|'s <a>text track map</a>.
                    </li>
                    <li>
                      <a>Obtain a set of CSS boxes</a> |boxes| positioned relative to an initial containing block.
                    </li>
                    <li>
                      Let |cue|’s <a data-cite='HTML51/semantics-embedded-content.html#text-track-cue-display-state'>text track cue display state</a> have the CSS boxes in |boxes|.
                    </li>
                    <li>
                      Add the CSS boxes in |boxes| to |map|.
                    </li>
                  </ol>
                </li>
              </ol>
            </li>
            <li>
              Return |output|.
            </li>
          </ol>
        </p>
      </section>
      !->

      <!--
      <section id='obtaining-css-boxes'>
        <h2>Obtaining CSS Boxes</h2>
        <p>
          When the processing algorithm above requires that the user agent <dfn>obtain a set of CSS boxes</dfn> |boxes|, then apply the terms of the <a data-cite='CSS22' data-no-xref=''>CSS</a> specifications to |nodes| within the following constraints:
          <ul>
            <li>
              The |document tree| is the tree of <a>WebVMT node objects</a> rooted at |nodes|.
            </li>
            <li>
              For the purpose of selectors in <code>STYLE</code> blocks of a WebVMT file, the style sheet must apply to a hypothetical document that contains a single empty element with no explicit name, no namespace, no attributes, no classes, and no IDs, that acts like the <a data-cite='HTML51/semantics-embedded-content.html#media-element'>media element</a> for the <a data-cite='HTML51/semantics-embedded-content.html#text-track'>text tracks</a> that were sourced from the given WebVMT file. The selectors must not match other <a data-cite='HTML51/semantics-embedded-content.html#text-track'>text tracks</a> for the same <a data-cite='HTML51/semantics-embedded-content.html#media-element'>media element</a>. In this hypothetical document, the element must not match any selector that would match the element itself.
            </li>
            <li class='note'>
              This element exists only to be the <a data-cite='SELECTORS4/#originating-element'>originating element</a> for the <span class='css'>::cue</span> and <span class='css'>::cue()</span><!--span class='css'>::cue-map</span> and <span class='css'>::cue-map()</span!-> pseudo-elements.
            </li>
            <li>
              For the purpose of determining the <a data-cite='CSS-CASCADE-4/#cascade'>cascade</a> of the declarations in <code>STYLE</code> blocks of a WebVMT file, the relative order of appearance of the style sheets must be the same order as they were added to the collection, and the order of appearance of the collection must be after any style sheets that apply to the associated <a data-cite='HTML51/semantics-embedded-content.html#the-video-element'><code>&lt;video&gt;</code></a> or <a data-cite='HTML51/semantics-embedded-content.html#the-audio-element'><code>&lt;audio&gt;</code></a> element’s document.
            </li>
            <aside class='example' title='Invalid Cascade'>
              <p>
                For example, given the following (invalid) HTML document:
              </p>
              <pre class='nohighlight'>
&lt;!doctype html&gt;
&lt;title&gt;Invalid cascade example&lt;/title&gt;
&lt;video controls autoplay src="video.webm"&gt;
  &lt;track default src="cascade.vmt"&gt;
&lt;/video&gt;
&lt;style&gt;
  ::cue { color:red }
&lt;/style&gt;
              </pre>
              <p>
                And the "cascade.vmt" file contains:
              </p>
              <pre class='nohighlight'>
WEBVMT

STYLE
::cue { color:lime }

00:00:00.000 --&gt; 00:00:25.000
Red or green?
              </pre>
              <p>
                The <span class='css'>color:lime</span> declaration would win, because it is last in the <a data-cite='CSS-CASCADE-4/#cascade'>cascade</a>, even though the <a data-cite='HTML51/semantics-embedded-content.html#the-style-element'><code>&lt;style&gt;</code></a> element is after the <a data-cite='HTML51/semantics-embedded-content.html#the-video-element'><code>&lt;video&gt;</code></a> element in the document order.
              </p>
            </aside>
            <li>
              For the purpose of resolving URLs in <code>STYLE</code> blocks of a WebVMT file, or any URLs in resources referenced from <code>STYLE</code> blocks of a WebVMT file, if the URL's scheme is not "<code>data</code>", then the user agent must act as if the URL failed to resolve.
            </li>
            <li>
              For the purposes of processing by the CSS specification, <a>WebVMT internal node objects</a> are equivalent to elements with the same contents.
            </li>
            <li>
              For the purposes of processing by the CSS specification, <a>WebVMT text objects</a> are equivalent to elements representing the same data structures.
            </li>
            <li>
              No style sheets are associated with |nodes|. (The nodes are subsequently restyled using style sheets after their boxes are generated, as described below.)
            </li>
            <!--li>
              The children of the |nodes| must be wrapped in an anonymous box whose <a data-cite='CSS-DISPLAY-3/#propdef-display'><span class='css'>display</span></a> property has the value <a data-cite='CSS-DISPLAY-3/#valdef-display-inline'><span class='css'>inline</span></a>. This is the <dfn>WebVMT cue background box</dfn>.
            </li!->
            <li>
              Properties on <a>WebVMT node objects</a> have their values set as defined in the next section. (That section uses some of the variables whose values were calculated earlier in this algorithm.)
            </li>
            <li>
              The map viewport (and initial containing block) is |map|'s rendering area.
            </li>
            <p>
              Let |boxes| be the boxes generated as descendants of the initial containing block, along with their positions.
            </p>
          </ul>
        </p>
      </section>
      !->
    </section>
    -->
    <section id='css-extensions'>
      <h2>CSS Extensions</h2>
      <p class='note'>
        This section specifies some CSS pseudo-elements and pseudo-classes and how they apply to WebVMT. This section does not apply to user agents that do not support CSS.
      </p>
      <section id='css-extensions-introduction'>
        <h2>Introduction</h2>
        <p>
          The <span class='css'>::cue</span> pseudo-element represents a cue.
        </p>
        <p>
          The <span class='css'>::cue(<var>selector</var>)</span> pseudo-element represents a cue or element inside a cue that match the given selector.
        </p>
        <!--p>
          The <span class='css'>::cue-map</span> pseudo-element represents a map viewport.
        </p>
        <p>
          The <span class='css'>::cue-map(<var>selector</var>)</span> pseudo-element represents an element inside a map viewport that matches the given selector.
        </p-->
        <p class='note'>
          Similarly to all other pseudo-elements, these pseudo-elements are not directly present in the <a data-cite='HTML51/semantics-embedded-content.html#the-video-element'><code>&lt;video&gt;</code></a> or <a data-cite='HTML51/semantics-embedded-content.html#the-audio-element'><code>&lt;audio&gt;</code></a> element’s document tree.
        </p>
        <p>
          A <dfn>WebVMT node object</dfn> is a conceptual construct used to represent components of cue metadata so that its processing can be described without reference to the underlying syntax.
        </p>
        <aside class='example'>
          The following table shows examples of what can be selected with a given selector, together with WebVMT syntax to produce the relevant objects.
          <table class='css-selector-table'>
            <tr>
              <th>
                Selector<br />(CSS syntax example)
              </th>
              <th>
                Matches<br />(WebVMT syntax example)
              </th>
            </tr>
            <tr>
              <td>
                <span class='css'>::cue</span>
                <pre class='nohighlight'>
video::cue {
  stroke: red;
}
                </pre>
              </td>
              <td>
                Any <a>WebVMT node objects</a>.
                <pre class='nohighlight'>
WEBVMT

NOTE Red

00:00:00.000 --&gt; 00:00:08.000
{ "moveto":
  { "lat": 51.504362, "lng": -0.076153 } }
{ "lineto":
  { "lat": 51.506646, "lng": -0.074651 } }

NOTE Also red!

00:00:08.000 --&gt; 00:00:16.000
{ "circle":
  { "lat": 51.504789, "lng": -0.078642,
    "rad": 20 } }
                </pre>
              </td>
            </tr>
            <tr>
              <td>
                <a data-cite='SELECTORS4/#id-selector'>ID selector</a> in <span class='css'>::cue()</span>
                <pre class='nohighlight'>
video::cue(#cue1) {
  stroke: red;
}
                </pre>
              </td>
              <td>
                Any <a>WebVMT node objects</a> constructed for a cue with a <a data-cite='HTML51/semantics-embedded-content.html#text-track-cue-identifier'>text track cue identifier</a> matching the given ID, e.g. cue1.
                <pre class='nohighlight'>
WEBVMT

NOTE Red

cue1
00:00:00.000 --&gt; 00:00:08.000
{ "moveto":
  { "lat": 51.504362, "lng": -0.076153 } }
{ "lineto":
  { "lat": 51.506646, "lng": -0.074651 } }

NOTE Not red

00:00:08.000 --&gt; 00:00:16.000
{ "circle":
  { "lat": 51.504789, "lng": -0.078642,
    "rad": 20 } }
                </pre>
              </td>
            </tr>
            <tr>
              <td>
                <a data-cite='SELECTORS4/#attribute-selector'>Attribute selector</a> in <span class="css">::cue()</span>
                <pre class='nohighlight'>
video::cue([zone="safe1"]) {
  stroke: red;
}
                </pre>
              </td>
              <td>
                For "path", any <a>WebVMT node object</a> with the given <a>path identifier</a>; for "zone", the <a>WebVMT node object</a> with the given <a>zone identifier</a>.
                <pre class='nohighlight'>
WEBVMT

NOTE Not red

00:00:00.000 --&gt; 00:00:08.000
{ "moveto":
  { "lat": 51.504362, "lng": -0.076153 } }
{ "lineto":
  { "lat": 51.506646, "lng": -0.074651 } }

NOTE Red

00:00:08.000 --&gt; 00:00:16.000
{ "circle":
  { "lat": 51.504789, "lng": -0.078642,
    "rad": 20, "zone": "safe1" } }
                </pre>
              </td>
            </tr>
          </table>
        </aside>
      </section>
      <section id='css-extensions-processing-model'>
        <h2>Processing Model</h2>
        <!--p>
          When a user agent is rendering one or more WebVMT cues according to the <a>rules for updating the display of WebVMT text tracks</a>, <a>WebVMT node objects</a> in the <a>list of WebVMT node objects</a> used in the rendering can be matched by certain pseudo-selectors as defined below. These selectors can begin or stop matching individual <a>WebVMT node objects</a> while a <a data-cite='HTML51/semantics-embedded-content.html#text-track-cue'>cue</a> is being rendered, even in between applications of the <a>rules for updating the display of WebVMT text tracks</a> (which are only run when the set of active cues changes). User agents that support the pseudo-element described below must dynamically update renderings accordingly.
        </p-->
        <p>
          Pseudo-elements apply to elements that are matched by selectors. For the purpose of this section, that element is the <i>matched element</i>. The pseudo-elements defined in the following sections affect the styling of parts of WebVMT cues that are being rendered for the <i>matched element</i>.
        </p>
        <p>
          A CSS user agent that implements the <a data-cite='HTML51/semantics-embedded-content.html#text-tracks'>text tracks</a> model must implement the <span class='css'>::cue</span> and <span class='css'>::cue(selector)</span> pseudo-elements.
        </p>
        <section id='cue-pseudo-element'>
          <h2>The <span class='css'>::cue</span> pseudo-element</h2>
          <p>
            The <span class='css'><dfn class='export'>::cue</dfn></span> pseudo-element (with no argument) matches any <a>WebVMT node objects</a> constructed for the <i>matched element</i>.
          </p>
          <p>
            The following properties apply to the <span class='css'>::cue</span> pseudo-element with no argument; other properties set on the pseudo-element must be ignored:
          </p>
          <p>
            <ul>
              <li>
                <span class='css'>stroke</span>
              </li>
              <li>
                <span class='css'>stroke-opacity</span>
              </li>
              <li>
                <span class='css'>stroke-width</span>
              </li>
              <li>
                <span class='css'>fill</span>
              </li>
              <li>
                <span class='css'>fill-opacity</span>
              </li>
            </ul>
          </p>
          <p>
            The <span class='css'><dfn class='export'>::cue(<var>selector</var>)</dfn></span> pseudo-element with an argument must have an argument that consists of a <a data-cite='SELECTORS4/#selector'>CSS selector</a>. It matches any <a>WebVMT <!--internal -->node object</a> constructed for the <i>matched element</i> that also matches the given CSS selector.<!--, with the nodes being treated as follows:-->
          </p>
          <!--
          <p>
            <ul>
              <li>
                The document tree against which the selectors are matched is the tree of <a>WebVMT node objects</a> rooted at the <a>list of WebVMT node objects</a> for the cue.
              </li>
              <li>
                <a>WebVMT internal node objects</a> are elements in the tree.
              </li>
              <li>
                <a>WebVMT leaf node objects</a> cannot be matched.
              </li>
              <li>
                For the purposes of element type and universal selectors, <a>WebVMT internal node objects</a> are considered as being in the namespace expressed as the empty string.
              </li>
              <li>
                <!-- how to access attributes? !->
                For the purposes of attribute selector matching, a <a>WebVMT internal node object</a> has attributes as given by the following table:
                <table>
                  <thead>
                    <tr>
                      <td>
                        <b>WebVMT command object</b>
                      </td>
                      <td>
                        <b>Attribute name</b>
                      </td>
                      <td>
                        <b>Attribute value</b>
                      </td>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>
                        <a>WebVMT zone object</a>
                      </td>
                      <td>
                        <code>zone</code>
                      </td>
                      <td>
                        <a>zone identifier</a>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <a>WebVMT path object</a>
                      </td>
                      <td>
                        <code>path</code>
                      </td>
                      <td>
                        <a>path identifier</a>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </li>
              <li>
                For the purposes of ID selector matching, a <a>list of WebVMT node objects</a> has the ID given by the cue’s <a data-cite='HTML51/semantics-embedded-content.html#text-track-cue-identifier'>text track cue identifier</a>, if any.
              </li>
            </ul>
          </p>
          -->
          <p>
            The following properties apply to the <span class='css'>::cue()</span> pseudo-element with an argument:
            <ul>
              <li>
                <span class='css'>stroke</span>
              </li>
              <li>
                <span class='css'>stroke-opacity</span>
              </li>
              <li>
                <span class='css'>stroke-width</span>
              </li>
              <li>
                <span class='css'>fill</span>
              </li>
              <li>
                <span class='css'>fill-opacity</span>
              </li>
            </ul>
          </p>
          <p>
            Properties that do not apply must be ignored.
          </p>
          <!--p>
            As a special exception, the properties corresponding to the background shorthand, when they would have been applied to the list of WebVTT Node Objects, must instead be applied to the WebVTT cue background box.
          </p-->
        </section>
        <!--section id='cue-map-pseudo-element'>
          <h2>The <span class='css'>::cue-map</span> pseudo-element</h2>
          <p>
            Pseudo-elements apply to elements that are matched by selectors. For the purpose of this section, that element is the <i>matched element</i>. The pseudo-element defined below affects the styling of text track regions that are being rendered for the <i>matched element</i>.
          </p>
          <p>
            The <span class='css'><dfn class='export'>::cue-map</dfn></span> pseudo-element (with no argument) matches the <a>WebVMT map object</a> constructed for the <i>matched element</i>.
          </p>
          <p>
            The same properties that apply to <span class='css'>::cue</span> apply to the <span class='css'>::cue-map</span> pseudo-element; other properties set on the pseudo-element must be ignored.
          </p>
          <p>
            When a user agent is rendering a text track map according to the <a>rules for updating the display of WebVMT text tracks</a>, the <a>WebVMT map object</a> used in the rendering can be matched by the above pseudo-element. User agents that support the pseudo-element must dynamically update renderings accordingly.
          </p>
        </section-->
      </section>
    </section>
    <section class='informative' id='knownissues'>
      <h2>Known Issues</h2>
      <p>
        This section captures issues which have been identified, but are not fully documented in this explanatory specification.
      </p>
      <p class='ednote'>
        As the specification develops, issues will be moved out of this section and included elsewhere in the document, until it is no longer needed and is completely removed.
      </p>
      <section id='plannedfeatures'>
        <h2>Planned Features</h2>
        <p>
          This section lists potential features which have been identified during the development process, but have not yet matured to a full design specification.
        </p>
        <p class='note'>
          Features which appear in this section warrant further investigation, but are not guaranteed to appear in the final specification.
        </p>
        <section id='marker'>
          <h2>Markers</h2>
          <p>
            An image linked to and displayed at an offset from a geolocation.
          </p>
        </section>
        <section id='label'>
          <h2>Labels</h2>
          <p>
            A text string linked to and displayed at an offset from a geolocation.
          </p>
        </section>
        <section id='tileshortcut'>
          <h2>Tile Shortcuts</h2>
          <p>
            Shortcuts to popular tile URLs for easy access and to help avoid URL syntax errors.
          </p>
        </section>
        <section id='layer'>
          <h2>Layers</h2>
          <p>
            Syntax to allow more than one layer of map tiles to be specified, e.g. 'map' and 'satellite' layers.
          </p>
          <p>
            This should be functional, but remain lightweight.
          </p>
        </section>
        <section id='multipleapis'>
          <h2>Multiple APIs</h2>
          <p>
            The current tech demo is based on the Leaflet API, but should be broadened to support other web map APIs, e.g. Open Layers.
          </p>
          <p>
            A hot-swap feature would allow users to switch API on-the-fly to take advantage of the unique features supported by different APIs, e.g. Street View.
          </p>
        </section>
        <section id='cameradirection'>
          <h2>Camera Direction</h2>
          <p>
            Camera orientation may not match the direction of travel, or may be dynamic, e.g. for Augmented Reality. Field of view and zoom level also affect video frame content and may vary over time.
          </p>
        </section>
        <section id='coordrefsys'>
          <h2>Co-ordinate Reference Systems</h2>
          <p>
            Although originally conceived for Earth-based use, spatial data in other environments could be accommodated by specifying the co-ordinate reference system. For example, location on another planet, e.g. Mars, or in an artifical environment, e.g. a video game.
          </p>
        </section>
        <section id='movingobjects'>
          <h2>Moving Objects</h2>
          <p>
            <a>WebVMT paths</a> represent objects moving through the mapped space, though could be extended to support properties associated with motion such as distance travelled, speed, heading, etc. through a defined API.
          </p>
          <p>
            Care should be taken to build a lightweight interface which includes simple, common properties that are useful to most use cases and avoids overloading with unnecessary edge cases, processing overheads and complexity.
          </p>
        </section>
        <section id='3dcoords'>
          <h2>3D Co-ordinates</h2>
          <p>
            Height could also be referenced either from mean sea level, e.g. for an aircraft, using a suitable Earth Gravitational Model (EGM) or from ground level, e.g. for the top of a structure.
          </p>
        </section>
      </section>
      <section id='plannedinterfaces'>
        <h2>Planned Interfaces</h2>
        <p>
          This section lists interfaces which have been identified during the development process, but have not yet matured to a full design specification.
        </p>
        <section id='cueinterface'>
          <h2>VMTCue Interface</h2>
          <p>
            Expose WebVMT Cues in the DOM API, based on the <a data-cite='HTML51/semantics-embedded-content.html#datacue-datacue'>HTML5 DataCue interface</a>. For example:
            <pre class='nohighlight' title='WebVMT Cue Interface'>
              [Exposed=Window,
              Constructor(double startTime, double endTime, DOMString text),
              Constructor(double startTime, DOMString text)]
              interface VMTCue : DataCue {
                attribute unrestricted double endTime;
              };
            </pre>
          </p>
          <p>
            This is analogous to the <a data-cite='WEBVTT#the-vttcue-interface'>VTTCue</a> interface.
          </p>
        </section>
        <section id='mapinterface'>
          <h2>VMTMap Interface</h2>
          <p>
            Expose WebVMT Maps in the DOM API. For example:
            <pre class='nohighlight' title='WebVMT Map Interface'>
              [Exposed=Window,
              Constructor]
              interface VMTMap {
                attribute double centerLat;
                attribute double centerLng;
                attribute double zoomRad;
                attribute object getMap;
              };
            </pre>
          </p>
          <p>
            This is analogous to the <a data-cite='WEBVTT#the-vttregion-interface'>VTTRegion</a> interface.
          </p>
        </section>
      </section>
    </section>
    <section id='privacy-security'>
      <h2>IANA Considerations</h2>
      <section id='text-vmt'>
        <h2><code>text/vmt</code></h2>
        <p>
          This registration is for community review and will be submitted to the IESG for review, approval, and registration with IANA.
        </p>
        <dl>
          <dt>
            Type name:
          </dt>
          <dd>
            text
          </dd>
          <dt>
            Subtype name:
          </dt>
          <dd>
            vmt
          </dd>
          <dt>
            Required parameters:
          </dt>
          <dd>
            No parameters
          </dd>
          <dt>
            Optional parameters:
          </dt>
          <dd>
            No parameters
          </dd>
          <dt>
            Encoding considerations:
          </dt>
          <dd>
            8bit (always UTF-8)
          </dd>
          <dt>
            Security considerations:
          </dt>
          <dd>
            Text track files themselves pose no immediate risk unless sensitive information is included within the data. Implementations, however, are required to follow specific rules when processing text tracks, to ensure that certain origin-based restrictions are honored. Failure to correctly implement these rules can result in information leakage, cross-site scripting attacks, and the like.
          </dd>
          <dt>
            Interoperability considerations:
          </dt>
          <dd>
            Rules for processing both conforming and non-conforming content are defined in this specification.
          </dd>
          <dt>
            Published specification:
          </dt>
          <dd>
            This document is the relevant specification.
          </dd>
          <dt>
            Applications that use this media type:
          </dt>
          <dd>
            Web browsers, other media players and location-aware video devices such as drones, dashcams and smartphones.
          </dd>
          <dt>
            Additional information:
          </dt>
          <dd>
            <dl>
              <dt>
                Magic number(s):
              </dt>
              <dd>
                WebVMT files all begin with one of the following byte sequences (where "EOF" means the end of the file):
                <ul>
                  <li>
                    EF BB BF 57 45 42 56 4D 54 0A
                  </li>
                  <li>
                    EF BB BF 57 45 42 56 4D 54 0D
                  </li>
                  <li>
                    EF BB BF 57 45 42 56 4D 54 20
                  </li>
                  <li>
                    EF BB BF 57 45 42 56 4D 54 09
                  </li>
                  <li>
                    EF BB BF 57 45 42 56 4D 54 EOF
                  </li>
                  <li>
                    57 45 42 56 4D 54 0A
                  </li>
                  <li>
                    57 45 42 56 4D 54 0D
                  </li>
                  <li>
                    57 45 42 56 4D 54 20
                  </li>
                  <li>
                    57 45 42 56 4D 54 09
                  </li>
                  <li>
                    57 45 42 56 4D 54 EOF
                  </li>
                </ul>
                <p class='note' title='Magic Numbers'>
                  (An optional UTF-8 BOM, the ASCII string "WEBVMT", and finally a space, tab, line break, or the end of the file.)
                </p>
              </dd>
              <dt>
                File extension(s):
              </dt>
              <dd>
                "vmt"
              </dd>
              <dt>
                Macintosh file type code(s):
              </dt>
              <dd>
                No specific Macintosh file type codes are recommended for this type.
              </dd>
            </dl>
          </dd>
          <dt>
            Person & email address to contact for further information:
          </dt>
          <dd>
            Rob Smith &lt;rob.smith@awayteam.co.uk&gt;
          </dd>
          <dt>
            Intended usage:
          </dt>
          <dd>
            Common
          </dd>
          <dt>
            Restrictions on usage:
          </dt>
          <dd>
            No restrictions apply.
          </dd>
          <dt>
            Authors:
          </dt>
          <dd>
            Rob Smith &lt;rob.smith@awayteam.co.uk&gt;
          </dd>
          <dt>
            Change controller:
          </dt>
          <dd>
            W3C
          </dd>
        </dl>
        <p>
          Fragment identifiers have no meaning with <code>text/vmt</code> resources.
        </p>
      </section>
    </section>
    <section class='informative, appendix' id='privacy-security'>
      <h2>Privacy and Security Considerations</h2>
      <section class='information' id='text-security'>
        <h2>Text-Based Format Security</h2>
        <p>
          As with any text-based format, it is possible to construct malicious content that might cause buffer over-runs, value overflows (e.g. string representations of integers that overflow a given word length), and the like. Implementers should take care in implementing a parser that over-long lines, field values, or encoded values do not cause security problems.
        </p>
      </section>
      <section class='information' id='style-security'>
        <h2>Styling-Related Privacy and Security</h2>
        <p>
          WebVMT can embed CSS style sheets, which will be applied in user agents that support CSS. Under these circumstances, the privacy and security considerations of CSS apply, with the following caveats.
        </p>
        <p>
          Such style sheets cannot fetch any external resources, and it is important for privacy that user agents do not allow this. Otherwise, WebVMT files could be authored such that a third party is notified when the user watches a particular video, and even the current time in that video.
        </p>
        <p>
          It is possible for a user agent to offer user style sheets, but their presence and nature will not be detectable by scripts running in the same user agent (e.g. browser) since the CSS object model for such style sheets is not exposed to script and there is no way to get the computed style for pseudo-elements other than ::before and ::after with the getComputedStyle() API. [CSSOM]
        </p>
      </section>
      <section class='information' id='script-security'>
        <h2>Scripting-Related Security</h2>
        <p>
          WebVMT does not include or enable scripting. It is important that user agents do not support a way to execute script embedded in a WebVMT file.
        </p>
        <p>
          However, it is possible to construct and deliver a file that is designed not to present timed metadata, but instead to provide timed input (‘triggers’) to a script system. A poorly-written script or script system might then cause security, privacy or other problems; however, this consideration really applies to the script system. Since WebVMT supplies these triggers at their timestamps, a malicious file might present such triggers very rapidly, perhaps causing undue resource consumption.
        </p>
      </section>
      <section class='information' id='location-security'>
        <h2>Location-Related Security</h2>
        <p>
          WebVMT provides a common format in which to share location data synchronized with video for the web. Proper consideration should be given to any sensitive details that may be revealed as a result of sharing such personal information. For example, posting a geotagged image online can reveal the location of the content creator at a particular time which can infer their absence from distant locations since travelling takes time. The identities of people who appear in video frames may be determined visually to also reveal their presence at a nearby location or their absence from a distant one.
        </p>
        <p>
          In order to share content responsibly, users should consider:
          <ol>
            <li>What is included?</li>
            <li>How can it be used?</li>
            <li>What can it tell others?</li>
          </ol>
          Further guidance for users, developers and regulators can be found in the W3C Note: <a data-cite='RESPONSIBLE-USE-SPATIAL' data-no-xref=''>The Responsible Use of Spatial Data</a>.
        </p>
      </section>
    </section>
  </body>
</html>
